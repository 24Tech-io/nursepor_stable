"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("src/middleware",{

/***/ "(middleware)/./src/lib/auth.ts":
/*!*************************!*\
  !*** ./src/lib/auth.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   authenticateUser: () => (/* binding */ authenticateUser),\n/* harmony export */   createSession: () => (/* binding */ createSession),\n/* harmony export */   createUser: () => (/* binding */ createUser),\n/* harmony export */   destroyAllUserSessions: () => (/* binding */ destroyAllUserSessions),\n/* harmony export */   destroySession: () => (/* binding */ destroySession),\n/* harmony export */   generateResetToken: () => (/* binding */ generateResetToken),\n/* harmony export */   generateToken: () => (/* binding */ generateToken),\n/* harmony export */   getUserAccounts: () => (/* binding */ getUserAccounts),\n/* harmony export */   hashPassword: () => (/* binding */ hashPassword),\n/* harmony export */   resetPassword: () => (/* binding */ resetPassword),\n/* harmony export */   validateSession: () => (/* binding */ validateSession),\n/* harmony export */   verifyPassword: () => (/* binding */ verifyPassword),\n/* harmony export */   verifyResetToken: () => (/* binding */ verifyResetToken),\n/* harmony export */   verifyToken: () => (/* binding */ verifyToken)\n/* harmony export */ });\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! bcryptjs */ \"(middleware)/./node_modules/bcryptjs/index.js\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jsonwebtoken */ \"(middleware)/./node_modules/jsonwebtoken/index.js\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./db */ \"(middleware)/./src/lib/db/index.ts\");\n/* harmony import */ var _db_schema__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./db/schema */ \"(middleware)/./src/lib/db/schema.ts\");\n/* harmony import */ var drizzle_orm__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! drizzle-orm */ \"(middleware)/./node_modules/drizzle-orm/sql/expressions/conditions.js\");\n/* harmony import */ var _security__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./security */ \"(middleware)/./src/lib/security.ts\");\n\n\n\n\n\n\n// JWT_SECRET must be set - no fallback for security\nif (!process.env.JWT_SECRET || process.env.JWT_SECRET === \"your-secret-key\" || process.env.JWT_SECRET.length < 32) {\n    throw new Error(\"JWT_SECRET must be set in environment variables and must be at least 32 characters long. \" + \"Please set a strong random secret in .env.local\");\n}\nconst JWT_SECRET = process.env.JWT_SECRET;\nconst JWT_EXPIRES_IN = \"7d\";\nasync function hashPassword(password) {\n    return bcryptjs__WEBPACK_IMPORTED_MODULE_0__[\"default\"].hash(password, 12);\n}\nasync function verifyPassword(password, hashedPassword) {\n    return bcryptjs__WEBPACK_IMPORTED_MODULE_0__[\"default\"].compare(password, hashedPassword);\n}\nfunction generateToken(user) {\n    return jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default().sign({\n        id: user.id,\n        name: user.name,\n        email: user.email,\n        role: user.role,\n        isActive: user.isActive\n    }, JWT_SECRET, {\n        expiresIn: JWT_EXPIRES_IN\n    });\n}\nfunction verifyToken(token) {\n    try {\n        const decoded = jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default().verify(token, JWT_SECRET);\n        return {\n            id: decoded.id,\n            name: decoded.name,\n            email: decoded.email,\n            role: decoded.role,\n            isActive: decoded.isActive\n        };\n    } catch (error) {\n        return null;\n    }\n}\nasync function createSession(userId, deviceInfo, userData) {\n    // Get user data if not provided\n    let user;\n    if (userData) {\n        user = userData;\n    } else {\n        const userResult = await _db__WEBPACK_IMPORTED_MODULE_2__.db.select().from(_db_schema__WEBPACK_IMPORTED_MODULE_3__.users).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_db_schema__WEBPACK_IMPORTED_MODULE_3__.users.id, userId)).limit(1);\n        if (!userResult.length) {\n            throw new Error(\"User not found\");\n        }\n        user = {\n            id: userResult[0].id,\n            name: userResult[0].name,\n            email: userResult[0].email,\n            role: userResult[0].role,\n            isActive: userResult[0].isActive\n        };\n    }\n    const sessionToken = generateToken(user);\n    const expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000); // 7 days\n    await _db__WEBPACK_IMPORTED_MODULE_2__.db.insert(_db_schema__WEBPACK_IMPORTED_MODULE_3__.sessions).values({\n        userId,\n        sessionToken,\n        deviceInfo: deviceInfo ? JSON.stringify(deviceInfo) : null,\n        expiresAt\n    });\n    return sessionToken;\n}\nasync function validateSession(sessionToken) {\n    const user = verifyToken(sessionToken);\n    if (!user) return null;\n    // Check if session exists in database\n    const session = await _db__WEBPACK_IMPORTED_MODULE_2__.db.select().from(_db_schema__WEBPACK_IMPORTED_MODULE_3__.sessions).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_db_schema__WEBPACK_IMPORTED_MODULE_3__.sessions.sessionToken, sessionToken), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_db_schema__WEBPACK_IMPORTED_MODULE_3__.sessions.userId, user.id))).limit(1);\n    if (!session.length || session[0].expiresAt < new Date()) {\n        return null;\n    }\n    return user;\n}\nasync function destroySession(sessionToken) {\n    await _db__WEBPACK_IMPORTED_MODULE_2__.db.delete(_db_schema__WEBPACK_IMPORTED_MODULE_3__.sessions).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_db_schema__WEBPACK_IMPORTED_MODULE_3__.sessions.sessionToken, sessionToken));\n}\nasync function destroyAllUserSessions(userId) {\n    await _db__WEBPACK_IMPORTED_MODULE_2__.db.delete(_db_schema__WEBPACK_IMPORTED_MODULE_3__.sessions).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_db_schema__WEBPACK_IMPORTED_MODULE_3__.sessions.userId, userId));\n}\nasync function authenticateUser(email, password, role) {\n    // If role is specified, authenticate that specific role\n    // Otherwise, get the first matching account (for backward compatibility)\n    const whereConditions = role ? (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_db_schema__WEBPACK_IMPORTED_MODULE_3__.users.email, email), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_db_schema__WEBPACK_IMPORTED_MODULE_3__.users.role, role), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_db_schema__WEBPACK_IMPORTED_MODULE_3__.users.isActive, true)) : (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_db_schema__WEBPACK_IMPORTED_MODULE_3__.users.email, email), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_db_schema__WEBPACK_IMPORTED_MODULE_3__.users.isActive, true));\n    const user = await _db__WEBPACK_IMPORTED_MODULE_2__.db.select().from(_db_schema__WEBPACK_IMPORTED_MODULE_3__.users).where(whereConditions).limit(1);\n    if (!user.length) return null;\n    const isValidPassword = await verifyPassword(password, user[0].password);\n    if (!isValidPassword) return null;\n    // Update last login\n    await _db__WEBPACK_IMPORTED_MODULE_2__.db.update(_db_schema__WEBPACK_IMPORTED_MODULE_3__.users).set({\n        lastLogin: new Date()\n    }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_db_schema__WEBPACK_IMPORTED_MODULE_3__.users.id, user[0].id));\n    return {\n        id: user[0].id,\n        name: user[0].name,\n        email: user[0].email,\n        phone: user[0].phone || null,\n        bio: user[0].bio || null,\n        role: user[0].role,\n        isActive: user[0].isActive,\n        faceIdEnrolled: user[0].faceIdEnrolled || false,\n        fingerprintEnrolled: user[0].fingerprintEnrolled || false,\n        twoFactorEnabled: user[0].twoFactorEnabled || false,\n        joinedDate: user[0].joinedDate || null\n    };\n}\n// Get all accounts (roles) for an email\nasync function getUserAccounts(email) {\n    const accounts = await _db__WEBPACK_IMPORTED_MODULE_2__.db.select().from(_db_schema__WEBPACK_IMPORTED_MODULE_3__.users).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_db_schema__WEBPACK_IMPORTED_MODULE_3__.users.email, email), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_db_schema__WEBPACK_IMPORTED_MODULE_3__.users.isActive, true)));\n    return accounts.map((user)=>({\n            id: user.id,\n            name: user.name,\n            email: user.email,\n            phone: user.phone || null,\n            bio: user.bio || null,\n            role: user.role,\n            isActive: user.isActive,\n            faceIdEnrolled: user.faceIdEnrolled || false,\n            fingerprintEnrolled: user.fingerprintEnrolled || false,\n            twoFactorEnabled: user.twoFactorEnabled || false,\n            joinedDate: user.joinedDate || null\n        }));\n}\nasync function createUser(userData) {\n    try {\n        console.log(\"createUser called with:\", {\n            email: userData.email,\n            role: userData.role\n        });\n        // Check if database is initialized\n        if (!_db__WEBPACK_IMPORTED_MODULE_2__.db) {\n            throw new Error(\"Database not initialized. Please check DATABASE_URL in .env.local\");\n        }\n        const hashedPassword = await hashPassword(userData.password);\n        console.log(\"Password hashed successfully\");\n        const newUser = await _db__WEBPACK_IMPORTED_MODULE_2__.db.insert(_db_schema__WEBPACK_IMPORTED_MODULE_3__.users).values({\n            name: userData.name,\n            email: userData.email,\n            password: hashedPassword,\n            phone: userData.phone,\n            role: userData.role || \"student\"\n        }).returning();\n        if (!newUser || newUser.length === 0) {\n            throw new Error(\"Failed to create user - no data returned from database\");\n        }\n        console.log(\"User inserted successfully:\", {\n            id: newUser[0].id,\n            email: newUser[0].email\n        });\n        return {\n            id: newUser[0].id,\n            name: newUser[0].name,\n            email: newUser[0].email,\n            phone: newUser[0].phone || null,\n            bio: newUser[0].bio || null,\n            role: newUser[0].role,\n            isActive: newUser[0].isActive,\n            faceIdEnrolled: newUser[0].faceIdEnrolled || false,\n            fingerprintEnrolled: newUser[0].fingerprintEnrolled || false,\n            twoFactorEnabled: newUser[0].twoFactorEnabled || false,\n            joinedDate: newUser[0].joinedDate || null\n        };\n    } catch (error) {\n        console.error(\"createUser function error:\", error);\n        console.error(\"Error details:\", {\n            message: error?.message,\n            code: error?.code,\n            detail: error?.detail,\n            constraint: error?.constraint\n        });\n        throw error; // Re-throw to let the caller handle it\n    }\n}\nasync function generateResetToken(email) {\n    const user = await _db__WEBPACK_IMPORTED_MODULE_2__.db.select().from(_db_schema__WEBPACK_IMPORTED_MODULE_3__.users).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_db_schema__WEBPACK_IMPORTED_MODULE_3__.users.email, email)).limit(1);\n    if (!user.length) return null;\n    // Use cryptographically secure random token\n    const resetToken = (0,_security__WEBPACK_IMPORTED_MODULE_4__.generateSecureToken)(32);\n    const resetTokenExpiry = new Date(Date.now() + 60 * 60 * 1000); // 1 hour\n    await _db__WEBPACK_IMPORTED_MODULE_2__.db.update(_db_schema__WEBPACK_IMPORTED_MODULE_3__.users).set({\n        resetToken,\n        resetTokenExpiry\n    }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_db_schema__WEBPACK_IMPORTED_MODULE_3__.users.id, user[0].id));\n    return resetToken;\n}\nasync function verifyResetToken(email, token) {\n    const user = await _db__WEBPACK_IMPORTED_MODULE_2__.db.select().from(_db_schema__WEBPACK_IMPORTED_MODULE_3__.users).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.and)((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_db_schema__WEBPACK_IMPORTED_MODULE_3__.users.email, email), (0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_db_schema__WEBPACK_IMPORTED_MODULE_3__.users.resetToken, token))).limit(1);\n    if (!user.length || !user[0].resetTokenExpiry) return false;\n    return user[0].resetTokenExpiry > new Date();\n}\nasync function resetPassword(email, token, newPassword) {\n    const isValid = await verifyResetToken(email, token);\n    if (!isValid) return false;\n    const hashedPassword = await hashPassword(newPassword);\n    await _db__WEBPACK_IMPORTED_MODULE_2__.db.update(_db_schema__WEBPACK_IMPORTED_MODULE_3__.users).set({\n        password: hashedPassword,\n        resetToken: null,\n        resetTokenExpiry: null\n    }).where((0,drizzle_orm__WEBPACK_IMPORTED_MODULE_5__.eq)(_db_schema__WEBPACK_IMPORTED_MODULE_3__.users.email, email));\n    return true;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cEIsK0NBQUVBLENBQUNGLDZDQUFLQSxDQUFDOEUsVUFBVSxFQUFFbkQsU0FFdEJZLEtBQUssQ0FBQztJQUVULElBQUksQ0FBQ3JCLEtBQUtWLE1BQU0sSUFBSSxDQUFDVSxJQUFJLENBQUMsRUFBRSxDQUFDNkQsZ0JBQWdCLEVBQUUsT0FBTztJQUV0RCxPQUFPN0QsSUFBSSxDQUFDLEVBQUUsQ0FBQzZELGdCQUFnQixHQUFHLElBQUlyQztBQUN4QztBQUVPLGVBQWV1QyxjQUFjM0QsS0FBYSxFQUFFSyxLQUFhLEVBQUV1RCxXQUFtQjtJQUNuRixNQUFNQyxVQUFVLE1BQU1ILGlCQUFpQjFELE9BQU9LO0lBQzlDLElBQUksQ0FBQ3dELFNBQVMsT0FBTztJQUVyQixNQUFNcEUsaUJBQWlCLE1BQU1KLGFBQWF1RTtJQUUxQyxNQUFNbkYsbUNBQUVBLENBQ0x5RCxNQUFNLENBQUN4RCw2Q0FBS0EsRUFDWnlELEdBQUcsQ0FBQztRQUNIN0MsVUFBVUc7UUFDVitELFlBQVk7UUFDWkMsa0JBQWtCO0lBQ3BCLEdBQ0N6QyxLQUFLLENBQUNwQywrQ0FBRUEsQ0FBQ0YsNkNBQUtBLENBQUNzQixLQUFLLEVBQUVBO0lBRXpCLE9BQU87QUFDVCIsInNvdXJjZXMiOlsid2VicGFjazovL19OX0UvLi9zcmMvbGliL2F1dGgudHM/NjY5MiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYmNyeXB0IGZyb20gJ2JjcnlwdGpzJztcclxuaW1wb3J0IGp3dCBmcm9tICdqc29ud2VidG9rZW4nO1xyXG5pbXBvcnQgeyBkYiB9IGZyb20gJy4vZGInO1xyXG5pbXBvcnQgeyB1c2Vycywgc2Vzc2lvbnMgfSBmcm9tICcuL2RiL3NjaGVtYSc7XHJcbmltcG9ydCB7IGVxLCBhbmQgfSBmcm9tICdkcml6emxlLW9ybSc7XHJcbmltcG9ydCB7IGdlbmVyYXRlU2VjdXJlVG9rZW4gfSBmcm9tICcuL3NlY3VyaXR5JztcclxuXHJcbi8vIEpXVF9TRUNSRVQgbXVzdCBiZSBzZXQgLSBubyBmYWxsYmFjayBmb3Igc2VjdXJpdHlcclxuaWYgKCFwcm9jZXNzLmVudi5KV1RfU0VDUkVUIHx8IHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgPT09ICd5b3VyLXNlY3JldC1rZXknIHx8IHByb2Nlc3MuZW52LkpXVF9TRUNSRVQubGVuZ3RoIDwgMzIpIHtcclxuICB0aHJvdyBuZXcgRXJyb3IoXHJcbiAgICAnSldUX1NFQ1JFVCBtdXN0IGJlIHNldCBpbiBlbnZpcm9ubWVudCB2YXJpYWJsZXMgYW5kIG11c3QgYmUgYXQgbGVhc3QgMzIgY2hhcmFjdGVycyBsb25nLiAnICtcclxuICAgICdQbGVhc2Ugc2V0IGEgc3Ryb25nIHJhbmRvbSBzZWNyZXQgaW4gLmVudi5sb2NhbCdcclxuICApO1xyXG59XHJcblxyXG5jb25zdCBKV1RfU0VDUkVUID0gcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVDtcclxuY29uc3QgSldUX0VYUElSRVNfSU4gPSAnN2QnO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBBdXRoVXNlciB7XHJcbiAgaWQ6IG51bWJlcjtcclxuICBuYW1lOiBzdHJpbmc7XHJcbiAgZW1haWw6IHN0cmluZztcclxuICBwaG9uZTogc3RyaW5nIHwgbnVsbDtcclxuICBiaW86IHN0cmluZyB8IG51bGw7XHJcbiAgcm9sZTogc3RyaW5nO1xyXG4gIGlzQWN0aXZlOiBib29sZWFuO1xyXG4gIGZhY2VJZEVucm9sbGVkOiBib29sZWFuO1xyXG4gIGZpbmdlcnByaW50RW5yb2xsZWQ6IGJvb2xlYW47XHJcbiAgdHdvRmFjdG9yRW5hYmxlZDogYm9vbGVhbjtcclxuICBqb2luZWREYXRlOiBEYXRlIHwgbnVsbDtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhc2hQYXNzd29yZChwYXNzd29yZDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICByZXR1cm4gYmNyeXB0Lmhhc2gocGFzc3dvcmQsIDEyKTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHZlcmlmeVBhc3N3b3JkKHBhc3N3b3JkOiBzdHJpbmcsIGhhc2hlZFBhc3N3b3JkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICByZXR1cm4gYmNyeXB0LmNvbXBhcmUocGFzc3dvcmQsIGhhc2hlZFBhc3N3b3JkKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlVG9rZW4odXNlcjogQXV0aFVzZXIpOiBzdHJpbmcge1xyXG4gIHJldHVybiBqd3Quc2lnbihcclxuICAgIHtcclxuICAgICAgaWQ6IHVzZXIuaWQsXHJcbiAgICAgIG5hbWU6IHVzZXIubmFtZSxcclxuICAgICAgZW1haWw6IHVzZXIuZW1haWwsXHJcbiAgICAgIHJvbGU6IHVzZXIucm9sZSxcclxuICAgICAgaXNBY3RpdmU6IHVzZXIuaXNBY3RpdmUsXHJcbiAgICB9LFxyXG4gICAgSldUX1NFQ1JFVCxcclxuICAgIHsgZXhwaXJlc0luOiBKV1RfRVhQSVJFU19JTiB9XHJcbiAgKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHZlcmlmeVRva2VuKHRva2VuOiBzdHJpbmcpOiBBdXRoVXNlciB8IG51bGwge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBkZWNvZGVkID0gand0LnZlcmlmeSh0b2tlbiwgSldUX1NFQ1JFVCkgYXMgYW55O1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgaWQ6IGRlY29kZWQuaWQsXHJcbiAgICAgIG5hbWU6IGRlY29kZWQubmFtZSxcclxuICAgICAgZW1haWw6IGRlY29kZWQuZW1haWwsXHJcbiAgICAgIHJvbGU6IGRlY29kZWQucm9sZSxcclxuICAgICAgaXNBY3RpdmU6IGRlY29kZWQuaXNBY3RpdmUsXHJcbiAgICB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVTZXNzaW9uKHVzZXJJZDogbnVtYmVyLCBkZXZpY2VJbmZvPzogYW55LCB1c2VyRGF0YT86IEF1dGhVc2VyKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICAvLyBHZXQgdXNlciBkYXRhIGlmIG5vdCBwcm92aWRlZFxyXG4gIGxldCB1c2VyOiBBdXRoVXNlcjtcclxuICBpZiAodXNlckRhdGEpIHtcclxuICAgIHVzZXIgPSB1c2VyRGF0YTtcclxuICB9IGVsc2Uge1xyXG4gICAgY29uc3QgdXNlclJlc3VsdCA9IGF3YWl0IGRiXHJcbiAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAuZnJvbSh1c2VycylcclxuICAgICAgLndoZXJlKGVxKHVzZXJzLmlkLCB1c2VySWQpKVxyXG4gICAgICAubGltaXQoMSk7XHJcbiAgICBcclxuICAgIGlmICghdXNlclJlc3VsdC5sZW5ndGgpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdVc2VyIG5vdCBmb3VuZCcpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICB1c2VyID0ge1xyXG4gICAgICBpZDogdXNlclJlc3VsdFswXS5pZCxcclxuICAgICAgbmFtZTogdXNlclJlc3VsdFswXS5uYW1lLFxyXG4gICAgICBlbWFpbDogdXNlclJlc3VsdFswXS5lbWFpbCxcclxuICAgICAgcm9sZTogdXNlclJlc3VsdFswXS5yb2xlLFxyXG4gICAgICBpc0FjdGl2ZTogdXNlclJlc3VsdFswXS5pc0FjdGl2ZSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBjb25zdCBzZXNzaW9uVG9rZW4gPSBnZW5lcmF0ZVRva2VuKHVzZXIpO1xyXG4gIGNvbnN0IGV4cGlyZXNBdCA9IG5ldyBEYXRlKERhdGUubm93KCkgKyA3ICogMjQgKiA2MCAqIDYwICogMTAwMCk7IC8vIDcgZGF5c1xyXG5cclxuICBhd2FpdCBkYi5pbnNlcnQoc2Vzc2lvbnMpLnZhbHVlcyh7XHJcbiAgICB1c2VySWQsXHJcbiAgICBzZXNzaW9uVG9rZW4sXHJcbiAgICBkZXZpY2VJbmZvOiBkZXZpY2VJbmZvID8gSlNPTi5zdHJpbmdpZnkoZGV2aWNlSW5mbykgOiBudWxsLFxyXG4gICAgZXhwaXJlc0F0LFxyXG4gIH0pO1xyXG5cclxuICByZXR1cm4gc2Vzc2lvblRva2VuO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdmFsaWRhdGVTZXNzaW9uKHNlc3Npb25Ub2tlbjogc3RyaW5nKTogUHJvbWlzZTxBdXRoVXNlciB8IG51bGw+IHtcclxuICBjb25zdCB1c2VyID0gdmVyaWZ5VG9rZW4oc2Vzc2lvblRva2VuKTtcclxuICBpZiAoIXVzZXIpIHJldHVybiBudWxsO1xyXG5cclxuICAvLyBDaGVjayBpZiBzZXNzaW9uIGV4aXN0cyBpbiBkYXRhYmFzZVxyXG4gIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBkYlxyXG4gICAgLnNlbGVjdCgpXHJcbiAgICAuZnJvbShzZXNzaW9ucylcclxuICAgIC53aGVyZShcclxuICAgICAgYW5kKFxyXG4gICAgICAgIGVxKHNlc3Npb25zLnNlc3Npb25Ub2tlbiwgc2Vzc2lvblRva2VuKSxcclxuICAgICAgICBlcShzZXNzaW9ucy51c2VySWQsIHVzZXIuaWQpXHJcbiAgICAgIClcclxuICAgIClcclxuICAgIC5saW1pdCgxKTtcclxuXHJcbiAgaWYgKCFzZXNzaW9uLmxlbmd0aCB8fCBzZXNzaW9uWzBdLmV4cGlyZXNBdCA8IG5ldyBEYXRlKCkpIHtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHVzZXI7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkZXN0cm95U2Vzc2lvbihzZXNzaW9uVG9rZW46IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xyXG4gIGF3YWl0IGRiLmRlbGV0ZShzZXNzaW9ucykud2hlcmUoZXEoc2Vzc2lvbnMuc2Vzc2lvblRva2VuLCBzZXNzaW9uVG9rZW4pKTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRlc3Ryb3lBbGxVc2VyU2Vzc2lvbnModXNlcklkOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcclxuICBhd2FpdCBkYi5kZWxldGUoc2Vzc2lvbnMpLndoZXJlKGVxKHNlc3Npb25zLnVzZXJJZCwgdXNlcklkKSk7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhdXRoZW50aWNhdGVVc2VyKGVtYWlsOiBzdHJpbmcsIHBhc3N3b3JkOiBzdHJpbmcsIHJvbGU/OiBzdHJpbmcpOiBQcm9taXNlPEF1dGhVc2VyIHwgbnVsbD4ge1xyXG4gIC8vIElmIHJvbGUgaXMgc3BlY2lmaWVkLCBhdXRoZW50aWNhdGUgdGhhdCBzcGVjaWZpYyByb2xlXHJcbiAgLy8gT3RoZXJ3aXNlLCBnZXQgdGhlIGZpcnN0IG1hdGNoaW5nIGFjY291bnQgKGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5KVxyXG4gIGNvbnN0IHdoZXJlQ29uZGl0aW9ucyA9IHJvbGUgXHJcbiAgICA/IGFuZChlcSh1c2Vycy5lbWFpbCwgZW1haWwpLCBlcSh1c2Vycy5yb2xlLCByb2xlKSwgZXEodXNlcnMuaXNBY3RpdmUsIHRydWUpKVxyXG4gICAgOiBhbmQoZXEodXNlcnMuZW1haWwsIGVtYWlsKSwgZXEodXNlcnMuaXNBY3RpdmUsIHRydWUpKTtcclxuICBcclxuICBjb25zdCB1c2VyID0gYXdhaXQgZGJcclxuICAgIC5zZWxlY3QoKVxyXG4gICAgLmZyb20odXNlcnMpXHJcbiAgICAud2hlcmUod2hlcmVDb25kaXRpb25zKVxyXG4gICAgLmxpbWl0KDEpO1xyXG5cclxuICBpZiAoIXVzZXIubGVuZ3RoKSByZXR1cm4gbnVsbDtcclxuXHJcbiAgY29uc3QgaXNWYWxpZFBhc3N3b3JkID0gYXdhaXQgdmVyaWZ5UGFzc3dvcmQocGFzc3dvcmQsIHVzZXJbMF0ucGFzc3dvcmQpO1xyXG4gIGlmICghaXNWYWxpZFBhc3N3b3JkKSByZXR1cm4gbnVsbDtcclxuXHJcbiAgLy8gVXBkYXRlIGxhc3QgbG9naW5cclxuICBhd2FpdCBkYlxyXG4gICAgLnVwZGF0ZSh1c2VycylcclxuICAgIC5zZXQoeyBsYXN0TG9naW46IG5ldyBEYXRlKCkgfSlcclxuICAgIC53aGVyZShlcSh1c2Vycy5pZCwgdXNlclswXS5pZCkpO1xyXG5cclxuICByZXR1cm4ge1xyXG4gICAgaWQ6IHVzZXJbMF0uaWQsXHJcbiAgICBuYW1lOiB1c2VyWzBdLm5hbWUsXHJcbiAgICBlbWFpbDogdXNlclswXS5lbWFpbCxcclxuICAgIHBob25lOiB1c2VyWzBdLnBob25lIHx8IG51bGwsXHJcbiAgICBiaW86IHVzZXJbMF0uYmlvIHx8IG51bGwsXHJcbiAgICByb2xlOiB1c2VyWzBdLnJvbGUsXHJcbiAgICBpc0FjdGl2ZTogdXNlclswXS5pc0FjdGl2ZSxcclxuICAgIGZhY2VJZEVucm9sbGVkOiB1c2VyWzBdLmZhY2VJZEVucm9sbGVkIHx8IGZhbHNlLFxyXG4gICAgZmluZ2VycHJpbnRFbnJvbGxlZDogdXNlclswXS5maW5nZXJwcmludEVucm9sbGVkIHx8IGZhbHNlLFxyXG4gICAgdHdvRmFjdG9yRW5hYmxlZDogdXNlclswXS50d29GYWN0b3JFbmFibGVkIHx8IGZhbHNlLFxyXG4gICAgam9pbmVkRGF0ZTogdXNlclswXS5qb2luZWREYXRlIHx8IG51bGwsXHJcbiAgfTtcclxufVxyXG5cclxuLy8gR2V0IGFsbCBhY2NvdW50cyAocm9sZXMpIGZvciBhbiBlbWFpbFxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VXNlckFjY291bnRzKGVtYWlsOiBzdHJpbmcpOiBQcm9taXNlPEF1dGhVc2VyW10+IHtcclxuICBjb25zdCBhY2NvdW50cyA9IGF3YWl0IGRiXHJcbiAgICAuc2VsZWN0KClcclxuICAgIC5mcm9tKHVzZXJzKVxyXG4gICAgLndoZXJlKGFuZChlcSh1c2Vycy5lbWFpbCwgZW1haWwpLCBlcSh1c2Vycy5pc0FjdGl2ZSwgdHJ1ZSkpKTtcclxuXHJcbiAgcmV0dXJuIGFjY291bnRzLm1hcCh1c2VyID0+ICh7XHJcbiAgICBpZDogdXNlci5pZCxcclxuICAgIG5hbWU6IHVzZXIubmFtZSxcclxuICAgIGVtYWlsOiB1c2VyLmVtYWlsLFxyXG4gICAgcGhvbmU6IHVzZXIucGhvbmUgfHwgbnVsbCxcclxuICAgIGJpbzogdXNlci5iaW8gfHwgbnVsbCxcclxuICAgIHJvbGU6IHVzZXIucm9sZSxcclxuICAgIGlzQWN0aXZlOiB1c2VyLmlzQWN0aXZlLFxyXG4gICAgZmFjZUlkRW5yb2xsZWQ6IHVzZXIuZmFjZUlkRW5yb2xsZWQgfHwgZmFsc2UsXHJcbiAgICBmaW5nZXJwcmludEVucm9sbGVkOiB1c2VyLmZpbmdlcnByaW50RW5yb2xsZWQgfHwgZmFsc2UsXHJcbiAgICB0d29GYWN0b3JFbmFibGVkOiB1c2VyLnR3b0ZhY3RvckVuYWJsZWQgfHwgZmFsc2UsXHJcbiAgICBqb2luZWREYXRlOiB1c2VyLmpvaW5lZERhdGUgfHwgbnVsbCxcclxuICB9KSk7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVVc2VyKHVzZXJEYXRhOiB7XHJcbiAgbmFtZTogc3RyaW5nO1xyXG4gIGVtYWlsOiBzdHJpbmc7XHJcbiAgcGFzc3dvcmQ6IHN0cmluZztcclxuICBwaG9uZT86IHN0cmluZztcclxuICByb2xlPzogc3RyaW5nO1xyXG59KTogUHJvbWlzZTxBdXRoVXNlcj4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zb2xlLmxvZygnY3JlYXRlVXNlciBjYWxsZWQgd2l0aDonLCB7IGVtYWlsOiB1c2VyRGF0YS5lbWFpbCwgcm9sZTogdXNlckRhdGEucm9sZSB9KTtcclxuICAgIFxyXG4gICAgLy8gQ2hlY2sgaWYgZGF0YWJhc2UgaXMgaW5pdGlhbGl6ZWRcclxuICAgIGlmICghZGIpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdEYXRhYmFzZSBub3QgaW5pdGlhbGl6ZWQuIFBsZWFzZSBjaGVjayBEQVRBQkFTRV9VUkwgaW4gLmVudi5sb2NhbCcpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGhhc2hlZFBhc3N3b3JkID0gYXdhaXQgaGFzaFBhc3N3b3JkKHVzZXJEYXRhLnBhc3N3b3JkKTtcclxuICAgIGNvbnNvbGUubG9nKCdQYXNzd29yZCBoYXNoZWQgc3VjY2Vzc2Z1bGx5Jyk7XHJcblxyXG4gICAgY29uc3QgbmV3VXNlciA9IGF3YWl0IGRiXHJcbiAgICAgIC5pbnNlcnQodXNlcnMpXHJcbiAgICAgIC52YWx1ZXMoe1xyXG4gICAgICAgIG5hbWU6IHVzZXJEYXRhLm5hbWUsXHJcbiAgICAgICAgZW1haWw6IHVzZXJEYXRhLmVtYWlsLFxyXG4gICAgICAgIHBhc3N3b3JkOiBoYXNoZWRQYXNzd29yZCxcclxuICAgICAgICBwaG9uZTogdXNlckRhdGEucGhvbmUsXHJcbiAgICAgICAgcm9sZTogdXNlckRhdGEucm9sZSB8fCAnc3R1ZGVudCcsXHJcbiAgICAgIH0pXHJcbiAgICAgIC5yZXR1cm5pbmcoKTtcclxuXHJcbiAgICBpZiAoIW5ld1VzZXIgfHwgbmV3VXNlci5sZW5ndGggPT09IDApIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gY3JlYXRlIHVzZXIgLSBubyBkYXRhIHJldHVybmVkIGZyb20gZGF0YWJhc2UnKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zb2xlLmxvZygnVXNlciBpbnNlcnRlZCBzdWNjZXNzZnVsbHk6JywgeyBpZDogbmV3VXNlclswXS5pZCwgZW1haWw6IG5ld1VzZXJbMF0uZW1haWwgfSk7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgaWQ6IG5ld1VzZXJbMF0uaWQsXHJcbiAgICAgIG5hbWU6IG5ld1VzZXJbMF0ubmFtZSxcclxuICAgICAgZW1haWw6IG5ld1VzZXJbMF0uZW1haWwsXHJcbiAgICAgIHBob25lOiBuZXdVc2VyWzBdLnBob25lIHx8IG51bGwsXHJcbiAgICAgIGJpbzogbmV3VXNlclswXS5iaW8gfHwgbnVsbCxcclxuICAgICAgcm9sZTogbmV3VXNlclswXS5yb2xlLFxyXG4gICAgICBpc0FjdGl2ZTogbmV3VXNlclswXS5pc0FjdGl2ZSxcclxuICAgICAgZmFjZUlkRW5yb2xsZWQ6IG5ld1VzZXJbMF0uZmFjZUlkRW5yb2xsZWQgfHwgZmFsc2UsXHJcbiAgICAgIGZpbmdlcnByaW50RW5yb2xsZWQ6IG5ld1VzZXJbMF0uZmluZ2VycHJpbnRFbnJvbGxlZCB8fCBmYWxzZSxcclxuICAgICAgdHdvRmFjdG9yRW5hYmxlZDogbmV3VXNlclswXS50d29GYWN0b3JFbmFibGVkIHx8IGZhbHNlLFxyXG4gICAgICBqb2luZWREYXRlOiBuZXdVc2VyWzBdLmpvaW5lZERhdGUgfHwgbnVsbCxcclxuICAgIH07XHJcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgY29uc29sZS5lcnJvcignY3JlYXRlVXNlciBmdW5jdGlvbiBlcnJvcjonLCBlcnJvcik7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkZXRhaWxzOicsIHtcclxuICAgICAgbWVzc2FnZTogZXJyb3I/Lm1lc3NhZ2UsXHJcbiAgICAgIGNvZGU6IGVycm9yPy5jb2RlLFxyXG4gICAgICBkZXRhaWw6IGVycm9yPy5kZXRhaWwsXHJcbiAgICAgIGNvbnN0cmFpbnQ6IGVycm9yPy5jb25zdHJhaW50LFxyXG4gICAgfSk7XHJcbiAgICB0aHJvdyBlcnJvcjsgLy8gUmUtdGhyb3cgdG8gbGV0IHRoZSBjYWxsZXIgaGFuZGxlIGl0XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVSZXNldFRva2VuKGVtYWlsOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcclxuICBjb25zdCB1c2VyID0gYXdhaXQgZGJcclxuICAgIC5zZWxlY3QoKVxyXG4gICAgLmZyb20odXNlcnMpXHJcbiAgICAud2hlcmUoZXEodXNlcnMuZW1haWwsIGVtYWlsKSlcclxuICAgIC5saW1pdCgxKTtcclxuXHJcbiAgaWYgKCF1c2VyLmxlbmd0aCkgcmV0dXJuIG51bGw7XHJcblxyXG4gIC8vIFVzZSBjcnlwdG9ncmFwaGljYWxseSBzZWN1cmUgcmFuZG9tIHRva2VuXHJcbiAgY29uc3QgcmVzZXRUb2tlbiA9IGdlbmVyYXRlU2VjdXJlVG9rZW4oMzIpO1xyXG4gIGNvbnN0IHJlc2V0VG9rZW5FeHBpcnkgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgNjAgKiA2MCAqIDEwMDApOyAvLyAxIGhvdXJcclxuXHJcbiAgYXdhaXQgZGJcclxuICAgIC51cGRhdGUodXNlcnMpXHJcbiAgICAuc2V0KHtcclxuICAgICAgcmVzZXRUb2tlbixcclxuICAgICAgcmVzZXRUb2tlbkV4cGlyeSxcclxuICAgIH0pXHJcbiAgICAud2hlcmUoZXEodXNlcnMuaWQsIHVzZXJbMF0uaWQpKTtcclxuXHJcbiAgcmV0dXJuIHJlc2V0VG9rZW47XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2ZXJpZnlSZXNldFRva2VuKGVtYWlsOiBzdHJpbmcsIHRva2VuOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICBjb25zdCB1c2VyID0gYXdhaXQgZGJcclxuICAgIC5zZWxlY3QoKVxyXG4gICAgLmZyb20odXNlcnMpXHJcbiAgICAud2hlcmUoYW5kKFxyXG4gICAgICBlcSh1c2Vycy5lbWFpbCwgZW1haWwpLFxyXG4gICAgICBlcSh1c2Vycy5yZXNldFRva2VuLCB0b2tlbilcclxuICAgICkpXHJcbiAgICAubGltaXQoMSk7XHJcblxyXG4gIGlmICghdXNlci5sZW5ndGggfHwgIXVzZXJbMF0ucmVzZXRUb2tlbkV4cGlyeSkgcmV0dXJuIGZhbHNlO1xyXG5cclxuICByZXR1cm4gdXNlclswXS5yZXNldFRva2VuRXhwaXJ5ID4gbmV3IERhdGUoKTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlc2V0UGFzc3dvcmQoZW1haWw6IHN0cmluZywgdG9rZW46IHN0cmluZywgbmV3UGFzc3dvcmQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG4gIGNvbnN0IGlzVmFsaWQgPSBhd2FpdCB2ZXJpZnlSZXNldFRva2VuKGVtYWlsLCB0b2tlbik7XHJcbiAgaWYgKCFpc1ZhbGlkKSByZXR1cm4gZmFsc2U7XHJcblxyXG4gIGNvbnN0IGhhc2hlZFBhc3N3b3JkID0gYXdhaXQgaGFzaFBhc3N3b3JkKG5ld1Bhc3N3b3JkKTtcclxuXHJcbiAgYXdhaXQgZGJcclxuICAgIC51cGRhdGUodXNlcnMpXHJcbiAgICAuc2V0KHtcclxuICAgICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxyXG4gICAgICByZXNldFRva2VuOiBudWxsLFxyXG4gICAgICByZXNldFRva2VuRXhwaXJ5OiBudWxsLFxyXG4gICAgfSlcclxuICAgIC53aGVyZShlcSh1c2Vycy5lbWFpbCwgZW1haWwpKTtcclxuXHJcbiAgcmV0dXJuIHRydWU7XHJcbn1cclxuIl0sIm5hbWVzIjpbImJjcnlwdCIsImp3dCIsImRiIiwidXNlcnMiLCJzZXNzaW9ucyIsImVxIiwiYW5kIiwiZ2VuZXJhdGVTZWN1cmVUb2tlbiIsInByb2Nlc3MiLCJlbnYiLCJKV1RfU0VDUkVUIiwibGVuZ3RoIiwiRXJyb3IiLCJKV1RfRVhQSVJFU19JTiIsImhhc2hQYXNzd29yZCIsInBhc3N3b3JkIiwiaGFzaCIsInZlcmlmeVBhc3N3b3JkIiwiaGFzaGVkUGFzc3dvcmQiLCJjb21wYXJlIiwiZ2VuZXJhdGVUb2tlbiIsInVzZXIiLCJzaWduIiwiaWQiLCJuYW1lIiwiZW1haWwiLCJyb2xlIiwiaXNBY3RpdmUiLCJleHBpcmVzSW4iLCJ2ZXJpZnlUb2tlbiIsInRva2VuIiwiZGVjb2RlZCIsInZlcmlmeSIsImVycm9yIiwiY3JlYXRlU2Vzc2lvbiIsInVzZXJJZCIsImRldmljZUluZm8iLCJ1c2VyRGF0YSIsInVzZXJSZXN1bHQiLCJzZWxlY3QiLCJmcm9tIiwid2hlcmUiLCJsaW1pdCIsInNlc3Npb25Ub2tlbiIsImV4cGlyZXNBdCIsIkRhdGUiLCJub3ciLCJpbnNlcnQiLCJ2YWx1ZXMiLCJKU09OIiwic3RyaW5naWZ5IiwidmFsaWRhdGVTZXNzaW9uIiwic2Vzc2lvbiIsImRlc3Ryb3lTZXNzaW9uIiwiZGVsZXRlIiwiZGVzdHJveUFsbFVzZXJTZXNzaW9ucyIsImF1dGhlbnRpY2F0ZVVzZXIiLCJ3aGVyZUNvbmRpdGlvbnMiLCJpc1ZhbGlkUGFzc3dvcmQiLCJ1cGRhdGUiLCJzZXQiLCJsYXN0TG9naW4iLCJwaG9uZSIsImJpbyIsImZhY2VJZEVucm9sbGVkIiwiZmluZ2VycHJpbnRFbnJvbGxlZCIsInR3b0ZhY3RvckVuYWJsZWQiLCJqb2luZWREYXRlIiwiZ2V0VXNlckFjY291bnRzIiwiYWNjb3VudHMiLCJtYXAiLCJjcmVhdGVVc2VyIiwiY29uc29sZSIsImxvZyIsIm5ld1VzZXIiLCJyZXR1cm5pbmciLCJtZXNzYWdlIiwiY29kZSIsImRldGFpbCIsImNvbnN0cmFpbnQiLCJnZW5lcmF0ZVJlc2V0VG9rZW4iLCJyZXNldFRva2VuIiwicmVzZXRUb2tlbkV4cGlyeSIsInZlcmlmeVJlc2V0VG9rZW4iLCJyZXNldFBhc3N3b3JkIiwibmV3UGFzc3dvcmQiLCJpc1ZhbGlkIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(middleware)/./src/lib/auth.ts\n");

/***/ })

});