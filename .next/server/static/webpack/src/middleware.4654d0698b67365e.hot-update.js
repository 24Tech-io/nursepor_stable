"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("src/middleware",{

/***/ "(middleware)/./src/middleware.ts":
/*!***************************!*\
  !*** ./src/middleware.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(middleware)/./node_modules/next/dist/esm/server/web/exports/next-response.js\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./lib/auth */ \"(middleware)/./src/lib/auth.ts\");\n\n\nasync function middleware(request) {\n    const { pathname } = request.nextUrl;\n    // Public routes that don't require authentication\n    const publicRoutes = [\n        \"/login\",\n        \"/register\",\n        \"/forgot-password\",\n        \"/reset-password\",\n        \"/\",\n        \"/admin\",\n        \"/student\"\n    ];\n    const isPublicRoute = publicRoutes.some((route)=>pathname === route || pathname.startsWith(route + \"/\"));\n    // API routes that don't require authentication\n    const publicApiRoutes = [\n        \"/api/auth/login\",\n        \"/api/auth/register\",\n        \"/api/auth/forgot-password\",\n        \"/api/auth/reset-password\",\n        \"/api/test-db\",\n        \"/api/payments/webhook\",\n        \"/api/auth/me\"\n    ];\n    const isPublicApiRoute = publicApiRoutes.some((route)=>pathname.startsWith(route));\n    // If it's a public route or API route, allow access\n    if (isPublicRoute || isPublicApiRoute) {\n        const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].next();\n        addSecurityHeaders(response);\n        return response;\n    }\n    // Check for authentication token cookie\n    const token = request.cookies.get(\"token\")?.value;\n    // Check if this is a redirect from login (check referer header)\n    const referer = request.headers.get(\"referer\");\n    const isFromLogin = referer?.includes(\"/login\");\n    const userAgent = request.headers.get(\"user-agent\") || \"\";\n    if (!token) {\n        // Redirect to login for protected API routes only\n        if (pathname.startsWith(\"/api/\")) {\n            // Allow public API routes through\n            if (isPublicApiRoute) {\n                const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].next();\n                addSecurityHeaders(response);\n                return response;\n            }\n            // For protected API routes, return 401\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                message: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n            addSecurityHeaders(response);\n            return response;\n        }\n        // For page routes (including /student and /admin), always allow through\n        // The pages themselves will handle authentication and redirect if needed\n        // This prevents middleware from blocking access while cookies are being set\n        const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].next();\n        addSecurityHeaders(response);\n        return response;\n    }\n    // Validate token\n    let user;\n    try {\n        user = (0,_lib_auth__WEBPACK_IMPORTED_MODULE_1__.verifyToken)(token);\n    } catch (error) {\n        console.error(\"Token verification error in middleware:\", error);\n        user = null;\n    }\n    if (!user) {\n        if (pathname.startsWith(\"/api/\")) {\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                message: \"Invalid or expired token\"\n            }, {\n                status: 401\n            });\n            addSecurityHeaders(response);\n            return response;\n        } else {\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].redirect(new URL(\"/login\", request.url));\n            response.cookies.delete(\"token\");\n            addSecurityHeaders(response);\n            return response;\n        }\n    }\n    // Check admin routes\n    if (pathname.startsWith(\"/admin\") && user.role !== \"admin\") {\n        if (pathname.startsWith(\"/api/\")) {\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Admin access required\"\n            }, {\n                status: 403\n            });\n            addSecurityHeaders(response);\n            return response;\n        } else {\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].redirect(new URL(\"/student/dashboard\", request.url));\n            addSecurityHeaders(response);\n            return response;\n        }\n    }\n    // Check student routes\n    if (pathname.startsWith(\"/student\") && user.role !== \"student\" && user.role !== \"admin\") {\n        if (pathname.startsWith(\"/api/\")) {\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Student access required\"\n            }, {\n                status: 403\n            });\n            addSecurityHeaders(response);\n            return response;\n        } else {\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].redirect(new URL(\"/login\", request.url));\n            addSecurityHeaders(response);\n            return response;\n        }\n    }\n    const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].next();\n    addSecurityHeaders(response);\n    return response;\n}\n// Add security headers\nfunction addSecurityHeaders(response) {\n    // Security headers\n    response.headers.set(\"X-Content-Type-Options\", \"nosniff\");\n    response.headers.set(\"X-Frame-Options\", \"DENY\");\n    response.headers.set(\"X-XSS-Protection\", \"1; mode=block\");\n    response.headers.set(\"Referrer-Policy\", \"strict-origin-when-cross-origin\");\n    response.headers.set(\"Permissions-Policy\", \"camera=(), microphone=(), geolocation=()\");\n    // Content Security Policy\n    const csp = [\n        \"default-src 'self'\",\n        \"script-src 'self' 'unsafe-eval' 'unsafe-inline' https://js.stripe.com\",\n        \"style-src 'self' 'unsafe-inline'\",\n        \"img-src 'self' data: https: blob:\",\n        \"font-src 'self' data:\",\n        \"connect-src 'self' https://api.stripe.com https://*.neon.tech\",\n        \"frame-src https://js.stripe.com https://hooks.stripe.com\",\n        \"object-src 'none'\",\n        \"base-uri 'self'\",\n        \"form-action 'self'\",\n        \"frame-ancestors 'none'\",\n        \"upgrade-insecure-requests\"\n    ].join(\"; \");\n    response.headers.set(\"Content-Security-Policy\", csp);\n    // Strict Transport Security (only in production)\n    if (false) {}\n}\nconst config = {\n    matcher: [\n        /*\r\n     * Match all request paths except for the ones starting with:\r\n     * - _next/static (static files)\r\n     * - _next/image (image optimization files)\r\n     * - favicon.ico (favicon file)\r\n     * - public folder\r\n     */ \"/((?!_next/static|_next/image|favicon.ico|public/).*)\"\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1FBQ0E7UUFDQTtLQUNELENBQUNDLElBQUksQ0FBQztJQUVQekIsU0FBU1EsT0FBTyxDQUFDZSxHQUFHLENBQUMsMkJBQTJCQztJQUVoRCxpREFBaUQ7SUFDakQsSUFBSUUsS0FBeUIsRUFBYyxFQUUxQztBQUNIO0FBRU8sTUFBTUMsU0FBUztJQUNwQkMsU0FBUztRQUNQOzs7Ozs7S0FNQyxHQUNEO0tBQ0Q7QUFDSCxFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vX05fRS8uL3NyYy9taWRkbGV3YXJlLnRzP2QxOTkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xyXG5pbXBvcnQgdHlwZSB7IE5leHRSZXF1ZXN0IH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xyXG5pbXBvcnQgeyB2ZXJpZnlUb2tlbiB9IGZyb20gJy4vbGliL2F1dGgnO1xyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIG1pZGRsZXdhcmUocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcclxuICBjb25zdCB7IHBhdGhuYW1lIH0gPSByZXF1ZXN0Lm5leHRVcmw7XHJcblxyXG4gIC8vIFB1YmxpYyByb3V0ZXMgdGhhdCBkb24ndCByZXF1aXJlIGF1dGhlbnRpY2F0aW9uXHJcbiAgY29uc3QgcHVibGljUm91dGVzID0gWycvbG9naW4nLCAnL3JlZ2lzdGVyJywgJy9mb3Jnb3QtcGFzc3dvcmQnLCAnL3Jlc2V0LXBhc3N3b3JkJywgJy8nLCAnL2FkbWluJywgJy9zdHVkZW50J107XHJcbiAgY29uc3QgaXNQdWJsaWNSb3V0ZSA9IHB1YmxpY1JvdXRlcy5zb21lKHJvdXRlID0+IHBhdGhuYW1lID09PSByb3V0ZSB8fCBwYXRobmFtZS5zdGFydHNXaXRoKHJvdXRlICsgJy8nKSk7XHJcblxyXG4gIC8vIEFQSSByb3V0ZXMgdGhhdCBkb24ndCByZXF1aXJlIGF1dGhlbnRpY2F0aW9uXHJcbiAgY29uc3QgcHVibGljQXBpUm91dGVzID0gW1xyXG4gICAgJy9hcGkvYXV0aC9sb2dpbicsXHJcbiAgICAnL2FwaS9hdXRoL3JlZ2lzdGVyJyxcclxuICAgICcvYXBpL2F1dGgvZm9yZ290LXBhc3N3b3JkJyxcclxuICAgICcvYXBpL2F1dGgvcmVzZXQtcGFzc3dvcmQnLFxyXG4gICAgJy9hcGkvdGVzdC1kYicsXHJcbiAgICAnL2FwaS9wYXltZW50cy93ZWJob29rJywgLy8gU3RyaXBlIHdlYmhvb2tcclxuICAgICcvYXBpL2F1dGgvbWUnLCAvLyBBbGxvdyAvYXBpL2F1dGgvbWUgdG8gYmUgY2FsbGVkIC0gaXQgd2lsbCBjaGVjayB0b2tlbiBpbnRlcm5hbGx5XHJcbiAgXTtcclxuICBjb25zdCBpc1B1YmxpY0FwaVJvdXRlID0gcHVibGljQXBpUm91dGVzLnNvbWUocm91dGUgPT4gcGF0aG5hbWUuc3RhcnRzV2l0aChyb3V0ZSkpO1xyXG5cclxuICAvLyBJZiBpdCdzIGEgcHVibGljIHJvdXRlIG9yIEFQSSByb3V0ZSwgYWxsb3cgYWNjZXNzXHJcbiAgaWYgKGlzUHVibGljUm91dGUgfHwgaXNQdWJsaWNBcGlSb3V0ZSkge1xyXG4gICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UubmV4dCgpO1xyXG4gICAgYWRkU2VjdXJpdHlIZWFkZXJzKHJlc3BvbnNlKTtcclxuICAgIHJldHVybiByZXNwb25zZTtcclxuICB9XHJcblxyXG4gIC8vIENoZWNrIGZvciBhdXRoZW50aWNhdGlvbiB0b2tlbiBjb29raWVcclxuICBjb25zdCB0b2tlbiA9IHJlcXVlc3QuY29va2llcy5nZXQoJ3Rva2VuJyk/LnZhbHVlO1xyXG4gIFxyXG4gIC8vIENoZWNrIGlmIHRoaXMgaXMgYSByZWRpcmVjdCBmcm9tIGxvZ2luIChjaGVjayByZWZlcmVyIGhlYWRlcilcclxuICBjb25zdCByZWZlcmVyID0gcmVxdWVzdC5oZWFkZXJzLmdldCgncmVmZXJlcicpO1xyXG4gIGNvbnN0IGlzRnJvbUxvZ2luID0gcmVmZXJlcj8uaW5jbHVkZXMoJy9sb2dpbicpO1xyXG4gIGNvbnN0IHVzZXJBZ2VudCA9IHJlcXVlc3QuaGVhZGVycy5nZXQoJ3VzZXItYWdlbnQnKSB8fCAnJztcclxuXHJcbiAgaWYgKCF0b2tlbikge1xyXG4gICAgLy8gUmVkaXJlY3QgdG8gbG9naW4gZm9yIHByb3RlY3RlZCBBUEkgcm91dGVzIG9ubHlcclxuICAgIGlmIChwYXRobmFtZS5zdGFydHNXaXRoKCcvYXBpLycpKSB7XHJcbiAgICAgIC8vIEFsbG93IHB1YmxpYyBBUEkgcm91dGVzIHRocm91Z2hcclxuICAgICAgaWYgKGlzUHVibGljQXBpUm91dGUpIHtcclxuICAgICAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5uZXh0KCk7XHJcbiAgICAgICAgYWRkU2VjdXJpdHlIZWFkZXJzKHJlc3BvbnNlKTtcclxuICAgICAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgICAgIH1cclxuICAgICAgLy8gRm9yIHByb3RlY3RlZCBBUEkgcm91dGVzLCByZXR1cm4gNDAxXHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLmpzb24oeyBtZXNzYWdlOiAnVW5hdXRob3JpemVkJyB9LCB7IHN0YXR1czogNDAxIH0pO1xyXG4gICAgICBhZGRTZWN1cml0eUhlYWRlcnMocmVzcG9uc2UpO1xyXG4gICAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIEZvciBwYWdlIHJvdXRlcyAoaW5jbHVkaW5nIC9zdHVkZW50IGFuZCAvYWRtaW4pLCBhbHdheXMgYWxsb3cgdGhyb3VnaFxyXG4gICAgLy8gVGhlIHBhZ2VzIHRoZW1zZWx2ZXMgd2lsbCBoYW5kbGUgYXV0aGVudGljYXRpb24gYW5kIHJlZGlyZWN0IGlmIG5lZWRlZFxyXG4gICAgLy8gVGhpcyBwcmV2ZW50cyBtaWRkbGV3YXJlIGZyb20gYmxvY2tpbmcgYWNjZXNzIHdoaWxlIGNvb2tpZXMgYXJlIGJlaW5nIHNldFxyXG4gICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UubmV4dCgpO1xyXG4gICAgYWRkU2VjdXJpdHlIZWFkZXJzKHJlc3BvbnNlKTtcclxuICAgIHJldHVybiByZXNwb25zZTtcclxuICB9XHJcblxyXG4gIC8vIFZhbGlkYXRlIHRva2VuXHJcbiAgbGV0IHVzZXI7XHJcbiAgdHJ5IHtcclxuICAgIHVzZXIgPSB2ZXJpZnlUb2tlbih0b2tlbik7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1Rva2VuIHZlcmlmaWNhdGlvbiBlcnJvciBpbiBtaWRkbGV3YXJlOicsIGVycm9yKTtcclxuICAgIHVzZXIgPSBudWxsO1xyXG4gIH1cclxuICBcclxuICBpZiAoIXVzZXIpIHtcclxuICAgIGlmIChwYXRobmFtZS5zdGFydHNXaXRoKCcvYXBpLycpKSB7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLmpzb24oeyBtZXNzYWdlOiAnSW52YWxpZCBvciBleHBpcmVkIHRva2VuJyB9LCB7IHN0YXR1czogNDAxIH0pO1xyXG4gICAgICBhZGRTZWN1cml0eUhlYWRlcnMocmVzcG9uc2UpO1xyXG4gICAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5yZWRpcmVjdChuZXcgVVJMKCcvbG9naW4nLCByZXF1ZXN0LnVybCkpO1xyXG4gICAgICByZXNwb25zZS5jb29raWVzLmRlbGV0ZSgndG9rZW4nKTtcclxuICAgICAgYWRkU2VjdXJpdHlIZWFkZXJzKHJlc3BvbnNlKTtcclxuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gQ2hlY2sgYWRtaW4gcm91dGVzXHJcbiAgaWYgKHBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9hZG1pbicpICYmIHVzZXIucm9sZSAhPT0gJ2FkbWluJykge1xyXG4gICAgaWYgKHBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9hcGkvJykpIHtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnQWRtaW4gYWNjZXNzIHJlcXVpcmVkJyB9LCB7IHN0YXR1czogNDAzIH0pO1xyXG4gICAgICBhZGRTZWN1cml0eUhlYWRlcnMocmVzcG9uc2UpO1xyXG4gICAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5yZWRpcmVjdChuZXcgVVJMKCcvc3R1ZGVudC9kYXNoYm9hcmQnLCByZXF1ZXN0LnVybCkpO1xyXG4gICAgICBhZGRTZWN1cml0eUhlYWRlcnMocmVzcG9uc2UpO1xyXG4gICAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBDaGVjayBzdHVkZW50IHJvdXRlc1xyXG4gIGlmIChwYXRobmFtZS5zdGFydHNXaXRoKCcvc3R1ZGVudCcpICYmIHVzZXIucm9sZSAhPT0gJ3N0dWRlbnQnICYmIHVzZXIucm9sZSAhPT0gJ2FkbWluJykge1xyXG4gICAgaWYgKHBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9hcGkvJykpIHtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnU3R1ZGVudCBhY2Nlc3MgcmVxdWlyZWQnIH0sIHsgc3RhdHVzOiA0MDMgfSk7XHJcbiAgICAgIGFkZFNlY3VyaXR5SGVhZGVycyhyZXNwb25zZSk7XHJcbiAgICAgIHJldHVybiByZXNwb25zZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KG5ldyBVUkwoJy9sb2dpbicsIHJlcXVlc3QudXJsKSk7XHJcbiAgICAgIGFkZFNlY3VyaXR5SGVhZGVycyhyZXNwb25zZSk7XHJcbiAgICAgIHJldHVybiByZXNwb25zZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLm5leHQoKTtcclxuICBhZGRTZWN1cml0eUhlYWRlcnMocmVzcG9uc2UpO1xyXG4gIHJldHVybiByZXNwb25zZTtcclxufVxyXG5cclxuLy8gQWRkIHNlY3VyaXR5IGhlYWRlcnNcclxuZnVuY3Rpb24gYWRkU2VjdXJpdHlIZWFkZXJzKHJlc3BvbnNlOiBOZXh0UmVzcG9uc2UpIHtcclxuICAvLyBTZWN1cml0eSBoZWFkZXJzXHJcbiAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ1gtQ29udGVudC1UeXBlLU9wdGlvbnMnLCAnbm9zbmlmZicpO1xyXG4gIHJlc3BvbnNlLmhlYWRlcnMuc2V0KCdYLUZyYW1lLU9wdGlvbnMnLCAnREVOWScpO1xyXG4gIHJlc3BvbnNlLmhlYWRlcnMuc2V0KCdYLVhTUy1Qcm90ZWN0aW9uJywgJzE7IG1vZGU9YmxvY2snKTtcclxuICByZXNwb25zZS5oZWFkZXJzLnNldCgnUmVmZXJyZXItUG9saWN5JywgJ3N0cmljdC1vcmlnaW4td2hlbi1jcm9zcy1vcmlnaW4nKTtcclxuICByZXNwb25zZS5oZWFkZXJzLnNldCgnUGVybWlzc2lvbnMtUG9saWN5JywgJ2NhbWVyYT0oKSwgbWljcm9waG9uZT0oKSwgZ2VvbG9jYXRpb249KCknKTtcclxuICBcclxuICAvLyBDb250ZW50IFNlY3VyaXR5IFBvbGljeVxyXG4gIGNvbnN0IGNzcCA9IFtcclxuICAgIFwiZGVmYXVsdC1zcmMgJ3NlbGYnXCIsXHJcbiAgICBcInNjcmlwdC1zcmMgJ3NlbGYnICd1bnNhZmUtZXZhbCcgJ3Vuc2FmZS1pbmxpbmUnIGh0dHBzOi8vanMuc3RyaXBlLmNvbVwiLFxyXG4gICAgXCJzdHlsZS1zcmMgJ3NlbGYnICd1bnNhZmUtaW5saW5lJ1wiLFxyXG4gICAgXCJpbWctc3JjICdzZWxmJyBkYXRhOiBodHRwczogYmxvYjpcIixcclxuICAgIFwiZm9udC1zcmMgJ3NlbGYnIGRhdGE6XCIsXHJcbiAgICBcImNvbm5lY3Qtc3JjICdzZWxmJyBodHRwczovL2FwaS5zdHJpcGUuY29tIGh0dHBzOi8vKi5uZW9uLnRlY2hcIixcclxuICAgIFwiZnJhbWUtc3JjIGh0dHBzOi8vanMuc3RyaXBlLmNvbSBodHRwczovL2hvb2tzLnN0cmlwZS5jb21cIixcclxuICAgIFwib2JqZWN0LXNyYyAnbm9uZSdcIixcclxuICAgIFwiYmFzZS11cmkgJ3NlbGYnXCIsXHJcbiAgICBcImZvcm0tYWN0aW9uICdzZWxmJ1wiLFxyXG4gICAgXCJmcmFtZS1hbmNlc3RvcnMgJ25vbmUnXCIsXHJcbiAgICBcInVwZ3JhZGUtaW5zZWN1cmUtcmVxdWVzdHNcIixcclxuICBdLmpvaW4oJzsgJyk7XHJcbiAgXHJcbiAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ0NvbnRlbnQtU2VjdXJpdHktUG9saWN5JywgY3NwKTtcclxuICBcclxuICAvLyBTdHJpY3QgVHJhbnNwb3J0IFNlY3VyaXR5IChvbmx5IGluIHByb2R1Y3Rpb24pXHJcbiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicpIHtcclxuICAgIHJlc3BvbnNlLmhlYWRlcnMuc2V0KCdTdHJpY3QtVHJhbnNwb3J0LVNlY3VyaXR5JywgJ21heC1hZ2U9MzE1MzYwMDA7IGluY2x1ZGVTdWJEb21haW5zOyBwcmVsb2FkJyk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgY29uc3QgY29uZmlnID0ge1xyXG4gIG1hdGNoZXI6IFtcclxuICAgIC8qXHJcbiAgICAgKiBNYXRjaCBhbGwgcmVxdWVzdCBwYXRocyBleGNlcHQgZm9yIHRoZSBvbmVzIHN0YXJ0aW5nIHdpdGg6XHJcbiAgICAgKiAtIF9uZXh0L3N0YXRpYyAoc3RhdGljIGZpbGVzKVxyXG4gICAgICogLSBfbmV4dC9pbWFnZSAoaW1hZ2Ugb3B0aW1pemF0aW9uIGZpbGVzKVxyXG4gICAgICogLSBmYXZpY29uLmljbyAoZmF2aWNvbiBmaWxlKVxyXG4gICAgICogLSBwdWJsaWMgZm9sZGVyXHJcbiAgICAgKi9cclxuICAgICcvKCg/IV9uZXh0L3N0YXRpY3xfbmV4dC9pbWFnZXxmYXZpY29uLmljb3xwdWJsaWMvKS4qKScsXHJcbiAgXSxcclxufTtcclxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsInZlcmlmeVRva2VuIiwibWlkZGxld2FyZSIsInJlcXVlc3QiLCJwYXRobmFtZSIsIm5leHRVcmwiLCJwdWJsaWNSb3V0ZXMiLCJpc1B1YmxpY1JvdXRlIiwic29tZSIsInJvdXRlIiwic3RhcnRzV2l0aCIsInB1YmxpY0FwaVJvdXRlcyIsImlzUHVibGljQXBpUm91dGUiLCJyZXNwb25zZSIsIm5leHQiLCJhZGRTZWN1cml0eUhlYWRlcnMiLCJ0b2tlbiIsImNvb2tpZXMiLCJnZXQiLCJ2YWx1ZSIsInJlZmVyZXIiLCJoZWFkZXJzIiwiaXNGcm9tTG9naW4iLCJpbmNsdWRlcyIsInVzZXJBZ2VudCIsImpzb24iLCJtZXNzYWdlIiwic3RhdHVzIiwidXNlciIsImVycm9yIiwiY29uc29sZSIsInJlZGlyZWN0IiwiVVJMIiwidXJsIiwiZGVsZXRlIiwicm9sZSIsInNldCIsImNzcCIsImpvaW4iLCJwcm9jZXNzIiwiY29uZmlnIiwibWF0Y2hlciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(middleware)/./src/middleware.ts\n");

/***/ })

});