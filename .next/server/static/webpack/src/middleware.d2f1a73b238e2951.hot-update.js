"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("src/middleware",{

/***/ "(middleware)/./src/middleware.ts":
/*!***************************!*\
  !*** ./src/middleware.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(middleware)/./node_modules/next/dist/esm/server/web/exports/next-response.js\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./lib/auth */ \"(middleware)/./src/lib/auth.ts\");\n\n\nasync function middleware(request) {\n    const { pathname } = request.nextUrl;\n    // Public routes that don't require authentication\n    const publicRoutes = [\n        \"/login\",\n        \"/register\",\n        \"/forgot-password\",\n        \"/reset-password\",\n        \"/\"\n    ];\n    const isPublicRoute = publicRoutes.some((route)=>pathname === route || pathname.startsWith(route + \"/\"));\n    // API routes that don't require authentication\n    const publicApiRoutes = [\n        \"/api/auth/login\",\n        \"/api/auth/register\",\n        \"/api/auth/forgot-password\",\n        \"/api/auth/reset-password\",\n        \"/api/test-db\",\n        \"/api/payments/webhook\"\n    ];\n    const isPublicApiRoute = publicApiRoutes.some((route)=>pathname.startsWith(route));\n    // If it's a public route or API route, allow access\n    if (isPublicRoute || isPublicApiRoute) {\n        const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].next();\n        addSecurityHeaders(response);\n        return response;\n    }\n    // Check for authentication token cookie\n    const token = request.cookies.get(\"token\")?.value;\n    // Check if this is a redirect from login (check referer header)\n    const referer = request.headers.get(\"referer\");\n    const isFromLogin = referer?.includes(\"/login\");\n    const userAgent = request.headers.get(\"user-agent\") || \"\";\n    if (!token) {\n        // Redirect to login for protected routes\n        if (pathname.startsWith(\"/api/\")) {\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                message: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n            addSecurityHeaders(response);\n            return response;\n        } else if (pathname.startsWith(\"/student\") || pathname.startsWith(\"/admin\")) {\n            // Special case: If coming from login page OR login API, allow through\n            // This prevents redirect loop after successful login\n            // The cookie might be setting, so give it a chance\n            if (isFromLogin || referer?.includes(\"/api/auth/login\")) {\n                console.log(\"⚠ No token but coming from login - allowing through (cookie might be setting)\");\n                console.log(\"⚠ Referer:\", referer);\n                console.log(\"⚠ Pathname:\", pathname);\n                const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].next();\n                addSecurityHeaders(response);\n                return response;\n            }\n            // For protected pages, redirect to login if no token\n            console.log(\"⚠ No token found for protected route:\", pathname);\n            console.log(\"⚠ Referer:\", referer);\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].redirect(new URL(\"/login\", request.url));\n            addSecurityHeaders(response);\n            return response;\n        }\n        // For other routes, allow through\n        const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].next();\n        addSecurityHeaders(response);\n        return response;\n    }\n    // Validate token\n    let user;\n    try {\n        user = (0,_lib_auth__WEBPACK_IMPORTED_MODULE_1__.verifyToken)(token);\n    } catch (error) {\n        console.error(\"Token verification error in middleware:\", error);\n        user = null;\n    }\n    if (!user) {\n        if (pathname.startsWith(\"/api/\")) {\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                message: \"Invalid or expired token\"\n            }, {\n                status: 401\n            });\n            addSecurityHeaders(response);\n            return response;\n        } else {\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].redirect(new URL(\"/login\", request.url));\n            response.cookies.delete(\"token\");\n            addSecurityHeaders(response);\n            return response;\n        }\n    }\n    // Check admin routes\n    if (pathname.startsWith(\"/admin\") && user.role !== \"admin\") {\n        if (pathname.startsWith(\"/api/\")) {\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Admin access required\"\n            }, {\n                status: 403\n            });\n            addSecurityHeaders(response);\n            return response;\n        } else {\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].redirect(new URL(\"/student/dashboard\", request.url));\n            addSecurityHeaders(response);\n            return response;\n        }\n    }\n    // Check student routes\n    if (pathname.startsWith(\"/student\") && user.role !== \"student\" && user.role !== \"admin\") {\n        if (pathname.startsWith(\"/api/\")) {\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Student access required\"\n            }, {\n                status: 403\n            });\n            addSecurityHeaders(response);\n            return response;\n        } else {\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].redirect(new URL(\"/login\", request.url));\n            addSecurityHeaders(response);\n            return response;\n        }\n    }\n    const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].next();\n    addSecurityHeaders(response);\n    return response;\n}\n// Add security headers\nfunction addSecurityHeaders(response) {\n    // Security headers\n    response.headers.set(\"X-Content-Type-Options\", \"nosniff\");\n    response.headers.set(\"X-Frame-Options\", \"DENY\");\n    response.headers.set(\"X-XSS-Protection\", \"1; mode=block\");\n    response.headers.set(\"Referrer-Policy\", \"strict-origin-when-cross-origin\");\n    response.headers.set(\"Permissions-Policy\", \"camera=(), microphone=(), geolocation=()\");\n    // Content Security Policy\n    const csp = [\n        \"default-src 'self'\",\n        \"script-src 'self' 'unsafe-eval' 'unsafe-inline' https://js.stripe.com\",\n        \"style-src 'self' 'unsafe-inline'\",\n        \"img-src 'self' data: https: blob:\",\n        \"font-src 'self' data:\",\n        \"connect-src 'self' https://api.stripe.com https://*.neon.tech\",\n        \"frame-src https://js.stripe.com https://hooks.stripe.com\",\n        \"object-src 'none'\",\n        \"base-uri 'self'\",\n        \"form-action 'self'\",\n        \"frame-ancestors 'none'\",\n        \"upgrade-insecure-requests\"\n    ].join(\"; \");\n    response.headers.set(\"Content-Security-Policy\", csp);\n    // Strict Transport Security (only in production)\n    if (false) {}\n}\nconst config = {\n    matcher: [\n        /*\r\n     * Match all request paths except for the ones starting with:\r\n     * - _next/static (static files)\r\n     * - _next/image (image optimization files)\r\n     * - favicon.ico (favicon file)\r\n     * - public folder\r\n     */ \"/((?!_next/static|_next/image|favicon.ico|public/).*)\"\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RixRQUFzQjtJQUNoRCxtQkFBbUI7SUFDbkJBLFNBQVNRLE9BQU8sQ0FBQ2dCLEdBQUcsQ0FBQywwQkFBMEI7SUFDL0N4QixTQUFTUSxPQUFPLENBQUNnQixHQUFHLENBQUMsbUJBQW1CO0lBQ3hDeEIsU0FBU1EsT0FBTyxDQUFDZ0IsR0FBRyxDQUFDLG9CQUFvQjtJQUN6Q3hCLFNBQVNRLE9BQU8sQ0FBQ2dCLEdBQUcsQ0FBQyxtQkFBbUI7SUFDeEN4QixTQUFTUSxPQUFPLENBQUNnQixHQUFHLENBQUMsc0JBQXNCO0lBRTNDLDBCQUEwQjtJQUMxQixNQUFNQyxNQUFNO1FBQ1Y7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO0tBQ0QsQ0FBQ0MsSUFBSSxDQUFDO0lBRVAxQixTQUFTUSxPQUFPLENBQUNnQixHQUFHLENBQUMsMkJBQTJCQztJQUVoRCxpREFBaUQ7SUFDakQsSUFBSUUsS0FBeUIsRUFBYyxFQUUxQztBQUNIO0FBRU8sTUFBTUMsU0FBUztJQUNwQkMsU0FBUztRQUNQOzs7Ozs7S0FNQyxHQUNEO0tBQ0Q7QUFDSCxFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vX05fRS8uL3NyYy9taWRkbGV3YXJlLnRzP2QxOTkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xyXG5pbXBvcnQgdHlwZSB7IE5leHRSZXF1ZXN0IH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xyXG5pbXBvcnQgeyB2ZXJpZnlUb2tlbiB9IGZyb20gJy4vbGliL2F1dGgnO1xyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIG1pZGRsZXdhcmUocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcclxuICBjb25zdCB7IHBhdGhuYW1lIH0gPSByZXF1ZXN0Lm5leHRVcmw7XHJcblxyXG4gIC8vIFB1YmxpYyByb3V0ZXMgdGhhdCBkb24ndCByZXF1aXJlIGF1dGhlbnRpY2F0aW9uXHJcbiAgY29uc3QgcHVibGljUm91dGVzID0gWycvbG9naW4nLCAnL3JlZ2lzdGVyJywgJy9mb3Jnb3QtcGFzc3dvcmQnLCAnL3Jlc2V0LXBhc3N3b3JkJywgJy8nXTtcclxuICBjb25zdCBpc1B1YmxpY1JvdXRlID0gcHVibGljUm91dGVzLnNvbWUocm91dGUgPT4gcGF0aG5hbWUgPT09IHJvdXRlIHx8IHBhdGhuYW1lLnN0YXJ0c1dpdGgocm91dGUgKyAnLycpKTtcclxuXHJcbiAgLy8gQVBJIHJvdXRlcyB0aGF0IGRvbid0IHJlcXVpcmUgYXV0aGVudGljYXRpb25cclxuICBjb25zdCBwdWJsaWNBcGlSb3V0ZXMgPSBbXHJcbiAgICAnL2FwaS9hdXRoL2xvZ2luJyxcclxuICAgICcvYXBpL2F1dGgvcmVnaXN0ZXInLFxyXG4gICAgJy9hcGkvYXV0aC9mb3Jnb3QtcGFzc3dvcmQnLFxyXG4gICAgJy9hcGkvYXV0aC9yZXNldC1wYXNzd29yZCcsXHJcbiAgICAnL2FwaS90ZXN0LWRiJyxcclxuICAgICcvYXBpL3BheW1lbnRzL3dlYmhvb2snLCAvLyBTdHJpcGUgd2ViaG9va1xyXG4gIF07XHJcbiAgY29uc3QgaXNQdWJsaWNBcGlSb3V0ZSA9IHB1YmxpY0FwaVJvdXRlcy5zb21lKHJvdXRlID0+IHBhdGhuYW1lLnN0YXJ0c1dpdGgocm91dGUpKTtcclxuXHJcbiAgLy8gSWYgaXQncyBhIHB1YmxpYyByb3V0ZSBvciBBUEkgcm91dGUsIGFsbG93IGFjY2Vzc1xyXG4gIGlmIChpc1B1YmxpY1JvdXRlIHx8IGlzUHVibGljQXBpUm91dGUpIHtcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLm5leHQoKTtcclxuICAgIGFkZFNlY3VyaXR5SGVhZGVycyhyZXNwb25zZSk7XHJcbiAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgfVxyXG5cclxuICAvLyBDaGVjayBmb3IgYXV0aGVudGljYXRpb24gdG9rZW4gY29va2llXHJcbiAgY29uc3QgdG9rZW4gPSByZXF1ZXN0LmNvb2tpZXMuZ2V0KCd0b2tlbicpPy52YWx1ZTtcclxuICBcclxuICAvLyBDaGVjayBpZiB0aGlzIGlzIGEgcmVkaXJlY3QgZnJvbSBsb2dpbiAoY2hlY2sgcmVmZXJlciBoZWFkZXIpXHJcbiAgY29uc3QgcmVmZXJlciA9IHJlcXVlc3QuaGVhZGVycy5nZXQoJ3JlZmVyZXInKTtcclxuICBjb25zdCBpc0Zyb21Mb2dpbiA9IHJlZmVyZXI/LmluY2x1ZGVzKCcvbG9naW4nKTtcclxuICBjb25zdCB1c2VyQWdlbnQgPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KCd1c2VyLWFnZW50JykgfHwgJyc7XHJcblxyXG4gIGlmICghdG9rZW4pIHtcclxuICAgIC8vIFJlZGlyZWN0IHRvIGxvZ2luIGZvciBwcm90ZWN0ZWQgcm91dGVzXHJcbiAgICBpZiAocGF0aG5hbWUuc3RhcnRzV2l0aCgnL2FwaS8nKSkge1xyXG4gICAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5qc29uKHsgbWVzc2FnZTogJ1VuYXV0aG9yaXplZCcgfSwgeyBzdGF0dXM6IDQwMSB9KTtcclxuICAgICAgYWRkU2VjdXJpdHlIZWFkZXJzKHJlc3BvbnNlKTtcclxuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gICAgfSBlbHNlIGlmIChwYXRobmFtZS5zdGFydHNXaXRoKCcvc3R1ZGVudCcpIHx8IHBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9hZG1pbicpKSB7XHJcbiAgICAgIC8vIFNwZWNpYWwgY2FzZTogSWYgY29taW5nIGZyb20gbG9naW4gcGFnZSBPUiBsb2dpbiBBUEksIGFsbG93IHRocm91Z2hcclxuICAgICAgLy8gVGhpcyBwcmV2ZW50cyByZWRpcmVjdCBsb29wIGFmdGVyIHN1Y2Nlc3NmdWwgbG9naW5cclxuICAgICAgLy8gVGhlIGNvb2tpZSBtaWdodCBiZSBzZXR0aW5nLCBzbyBnaXZlIGl0IGEgY2hhbmNlXHJcbiAgICAgIGlmIChpc0Zyb21Mb2dpbiB8fCByZWZlcmVyPy5pbmNsdWRlcygnL2FwaS9hdXRoL2xvZ2luJykpIHtcclxuICAgICAgICBjb25zb2xlLmxvZygn4pqgIE5vIHRva2VuIGJ1dCBjb21pbmcgZnJvbSBsb2dpbiAtIGFsbG93aW5nIHRocm91Z2ggKGNvb2tpZSBtaWdodCBiZSBzZXR0aW5nKScpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCfimqAgUmVmZXJlcjonLCByZWZlcmVyKTtcclxuICAgICAgICBjb25zb2xlLmxvZygn4pqgIFBhdGhuYW1lOicsIHBhdGhuYW1lKTtcclxuICAgICAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5uZXh0KCk7XHJcbiAgICAgICAgYWRkU2VjdXJpdHlIZWFkZXJzKHJlc3BvbnNlKTtcclxuICAgICAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIEZvciBwcm90ZWN0ZWQgcGFnZXMsIHJlZGlyZWN0IHRvIGxvZ2luIGlmIG5vIHRva2VuXHJcbiAgICAgIGNvbnNvbGUubG9nKCfimqAgTm8gdG9rZW4gZm91bmQgZm9yIHByb3RlY3RlZCByb3V0ZTonLCBwYXRobmFtZSk7XHJcbiAgICAgIGNvbnNvbGUubG9nKCfimqAgUmVmZXJlcjonLCByZWZlcmVyKTtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTCgnL2xvZ2luJywgcmVxdWVzdC51cmwpKTtcclxuICAgICAgYWRkU2VjdXJpdHlIZWFkZXJzKHJlc3BvbnNlKTtcclxuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBGb3Igb3RoZXIgcm91dGVzLCBhbGxvdyB0aHJvdWdoXHJcbiAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5uZXh0KCk7XHJcbiAgICBhZGRTZWN1cml0eUhlYWRlcnMocmVzcG9uc2UpO1xyXG4gICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gIH1cclxuXHJcbiAgLy8gVmFsaWRhdGUgdG9rZW5cclxuICBsZXQgdXNlcjtcclxuICB0cnkge1xyXG4gICAgdXNlciA9IHZlcmlmeVRva2VuKHRva2VuKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignVG9rZW4gdmVyaWZpY2F0aW9uIGVycm9yIGluIG1pZGRsZXdhcmU6JywgZXJyb3IpO1xyXG4gICAgdXNlciA9IG51bGw7XHJcbiAgfVxyXG4gIFxyXG4gIGlmICghdXNlcikge1xyXG4gICAgaWYgKHBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9hcGkvJykpIHtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UuanNvbih7IG1lc3NhZ2U6ICdJbnZhbGlkIG9yIGV4cGlyZWQgdG9rZW4nIH0sIHsgc3RhdHVzOiA0MDEgfSk7XHJcbiAgICAgIGFkZFNlY3VyaXR5SGVhZGVycyhyZXNwb25zZSk7XHJcbiAgICAgIHJldHVybiByZXNwb25zZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KG5ldyBVUkwoJy9sb2dpbicsIHJlcXVlc3QudXJsKSk7XHJcbiAgICAgIHJlc3BvbnNlLmNvb2tpZXMuZGVsZXRlKCd0b2tlbicpO1xyXG4gICAgICBhZGRTZWN1cml0eUhlYWRlcnMocmVzcG9uc2UpO1xyXG4gICAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBDaGVjayBhZG1pbiByb3V0ZXNcclxuICBpZiAocGF0aG5hbWUuc3RhcnRzV2l0aCgnL2FkbWluJykgJiYgdXNlci5yb2xlICE9PSAnYWRtaW4nKSB7XHJcbiAgICBpZiAocGF0aG5hbWUuc3RhcnRzV2l0aCgnL2FwaS8nKSkge1xyXG4gICAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdBZG1pbiBhY2Nlc3MgcmVxdWlyZWQnIH0sIHsgc3RhdHVzOiA0MDMgfSk7XHJcbiAgICAgIGFkZFNlY3VyaXR5SGVhZGVycyhyZXNwb25zZSk7XHJcbiAgICAgIHJldHVybiByZXNwb25zZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KG5ldyBVUkwoJy9zdHVkZW50L2Rhc2hib2FyZCcsIHJlcXVlc3QudXJsKSk7XHJcbiAgICAgIGFkZFNlY3VyaXR5SGVhZGVycyhyZXNwb25zZSk7XHJcbiAgICAgIHJldHVybiByZXNwb25zZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIENoZWNrIHN0dWRlbnQgcm91dGVzXHJcbiAgaWYgKHBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9zdHVkZW50JykgJiYgdXNlci5yb2xlICE9PSAnc3R1ZGVudCcgJiYgdXNlci5yb2xlICE9PSAnYWRtaW4nKSB7XHJcbiAgICBpZiAocGF0aG5hbWUuc3RhcnRzV2l0aCgnL2FwaS8nKSkge1xyXG4gICAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdTdHVkZW50IGFjY2VzcyByZXF1aXJlZCcgfSwgeyBzdGF0dXM6IDQwMyB9KTtcclxuICAgICAgYWRkU2VjdXJpdHlIZWFkZXJzKHJlc3BvbnNlKTtcclxuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTCgnL2xvZ2luJywgcmVxdWVzdC51cmwpKTtcclxuICAgICAgYWRkU2VjdXJpdHlIZWFkZXJzKHJlc3BvbnNlKTtcclxuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UubmV4dCgpO1xyXG4gIGFkZFNlY3VyaXR5SGVhZGVycyhyZXNwb25zZSk7XHJcbiAgcmV0dXJuIHJlc3BvbnNlO1xyXG59XHJcblxyXG4vLyBBZGQgc2VjdXJpdHkgaGVhZGVyc1xyXG5mdW5jdGlvbiBhZGRTZWN1cml0eUhlYWRlcnMocmVzcG9uc2U6IE5leHRSZXNwb25zZSkge1xyXG4gIC8vIFNlY3VyaXR5IGhlYWRlcnNcclxuICByZXNwb25zZS5oZWFkZXJzLnNldCgnWC1Db250ZW50LVR5cGUtT3B0aW9ucycsICdub3NuaWZmJyk7XHJcbiAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ1gtRnJhbWUtT3B0aW9ucycsICdERU5ZJyk7XHJcbiAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ1gtWFNTLVByb3RlY3Rpb24nLCAnMTsgbW9kZT1ibG9jaycpO1xyXG4gIHJlc3BvbnNlLmhlYWRlcnMuc2V0KCdSZWZlcnJlci1Qb2xpY3knLCAnc3RyaWN0LW9yaWdpbi13aGVuLWNyb3NzLW9yaWdpbicpO1xyXG4gIHJlc3BvbnNlLmhlYWRlcnMuc2V0KCdQZXJtaXNzaW9ucy1Qb2xpY3knLCAnY2FtZXJhPSgpLCBtaWNyb3Bob25lPSgpLCBnZW9sb2NhdGlvbj0oKScpO1xyXG4gIFxyXG4gIC8vIENvbnRlbnQgU2VjdXJpdHkgUG9saWN5XHJcbiAgY29uc3QgY3NwID0gW1xyXG4gICAgXCJkZWZhdWx0LXNyYyAnc2VsZidcIixcclxuICAgIFwic2NyaXB0LXNyYyAnc2VsZicgJ3Vuc2FmZS1ldmFsJyAndW5zYWZlLWlubGluZScgaHR0cHM6Ly9qcy5zdHJpcGUuY29tXCIsXHJcbiAgICBcInN0eWxlLXNyYyAnc2VsZicgJ3Vuc2FmZS1pbmxpbmUnXCIsXHJcbiAgICBcImltZy1zcmMgJ3NlbGYnIGRhdGE6IGh0dHBzOiBibG9iOlwiLFxyXG4gICAgXCJmb250LXNyYyAnc2VsZicgZGF0YTpcIixcclxuICAgIFwiY29ubmVjdC1zcmMgJ3NlbGYnIGh0dHBzOi8vYXBpLnN0cmlwZS5jb20gaHR0cHM6Ly8qLm5lb24udGVjaFwiLFxyXG4gICAgXCJmcmFtZS1zcmMgaHR0cHM6Ly9qcy5zdHJpcGUuY29tIGh0dHBzOi8vaG9va3Muc3RyaXBlLmNvbVwiLFxyXG4gICAgXCJvYmplY3Qtc3JjICdub25lJ1wiLFxyXG4gICAgXCJiYXNlLXVyaSAnc2VsZidcIixcclxuICAgIFwiZm9ybS1hY3Rpb24gJ3NlbGYnXCIsXHJcbiAgICBcImZyYW1lLWFuY2VzdG9ycyAnbm9uZSdcIixcclxuICAgIFwidXBncmFkZS1pbnNlY3VyZS1yZXF1ZXN0c1wiLFxyXG4gIF0uam9pbignOyAnKTtcclxuICBcclxuICByZXNwb25zZS5oZWFkZXJzLnNldCgnQ29udGVudC1TZWN1cml0eS1Qb2xpY3knLCBjc3ApO1xyXG4gIFxyXG4gIC8vIFN0cmljdCBUcmFuc3BvcnQgU2VjdXJpdHkgKG9ubHkgaW4gcHJvZHVjdGlvbilcclxuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJykge1xyXG4gICAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ1N0cmljdC1UcmFuc3BvcnQtU2VjdXJpdHknLCAnbWF4LWFnZT0zMTUzNjAwMDsgaW5jbHVkZVN1YkRvbWFpbnM7IHByZWxvYWQnKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBjb25maWcgPSB7XHJcbiAgbWF0Y2hlcjogW1xyXG4gICAgLypcclxuICAgICAqIE1hdGNoIGFsbCByZXF1ZXN0IHBhdGhzIGV4Y2VwdCBmb3IgdGhlIG9uZXMgc3RhcnRpbmcgd2l0aDpcclxuICAgICAqIC0gX25leHQvc3RhdGljIChzdGF0aWMgZmlsZXMpXHJcbiAgICAgKiAtIF9uZXh0L2ltYWdlIChpbWFnZSBvcHRpbWl6YXRpb24gZmlsZXMpXHJcbiAgICAgKiAtIGZhdmljb24uaWNvIChmYXZpY29uIGZpbGUpXHJcbiAgICAgKiAtIHB1YmxpYyBmb2xkZXJcclxuICAgICAqL1xyXG4gICAgJy8oKD8hX25leHQvc3RhdGljfF9uZXh0L2ltYWdlfGZhdmljb24uaWNvfHB1YmxpYy8pLiopJyxcclxuICBdLFxyXG59O1xyXG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwidmVyaWZ5VG9rZW4iLCJtaWRkbGV3YXJlIiwicmVxdWVzdCIsInBhdGhuYW1lIiwibmV4dFVybCIsInB1YmxpY1JvdXRlcyIsImlzUHVibGljUm91dGUiLCJzb21lIiwicm91dGUiLCJzdGFydHNXaXRoIiwicHVibGljQXBpUm91dGVzIiwiaXNQdWJsaWNBcGlSb3V0ZSIsInJlc3BvbnNlIiwibmV4dCIsImFkZFNlY3VyaXR5SGVhZGVycyIsInRva2VuIiwiY29va2llcyIsImdldCIsInZhbHVlIiwicmVmZXJlciIsImhlYWRlcnMiLCJpc0Zyb21Mb2dpbiIsImluY2x1ZGVzIiwidXNlckFnZW50IiwianNvbiIsIm1lc3NhZ2UiLCJzdGF0dXMiLCJjb25zb2xlIiwibG9nIiwicmVkaXJlY3QiLCJVUkwiLCJ1cmwiLCJ1c2VyIiwiZXJyb3IiLCJkZWxldGUiLCJyb2xlIiwic2V0IiwiY3NwIiwiam9pbiIsInByb2Nlc3MiLCJjb25maWciLCJtYXRjaGVyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(middleware)/./src/middleware.ts\n");

/***/ })

});