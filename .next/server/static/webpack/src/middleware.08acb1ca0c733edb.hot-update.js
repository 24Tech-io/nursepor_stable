"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("src/middleware",{

/***/ "(middleware)/./src/middleware.ts":
/*!***************************!*\
  !*** ./src/middleware.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(middleware)/./node_modules/next/dist/esm/server/web/exports/next-response.js\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./lib/auth */ \"(middleware)/./src/lib/auth.ts\");\n\n\nasync function middleware(request) {\n    const { pathname } = request.nextUrl;\n    // Public routes that don't require authentication\n    const publicRoutes = [\n        \"/login\",\n        \"/register\",\n        \"/forgot-password\",\n        \"/reset-password\",\n        \"/\",\n        \"/admin\",\n        \"/student\"\n    ];\n    const isPublicRoute = publicRoutes.some((route)=>pathname === route || pathname.startsWith(route + \"/\"));\n    // API routes that don't require authentication\n    const publicApiRoutes = [\n        \"/api/auth/login\",\n        \"/api/auth/register\",\n        \"/api/auth/forgot-password\",\n        \"/api/auth/reset-password\",\n        \"/api/test-db\",\n        \"/api/payments/webhook\",\n        \"/api/auth/me\"\n    ];\n    const isPublicApiRoute = publicApiRoutes.some((route)=>pathname.startsWith(route));\n    // If it's a public route or API route, allow access\n    if (isPublicRoute || isPublicApiRoute) {\n        const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].next();\n        addSecurityHeaders(response);\n        return response;\n    }\n    // Check for authentication token cookie\n    const token = request.cookies.get(\"token\")?.value;\n    // Check if this is a redirect from login (check referer header)\n    const referer = request.headers.get(\"referer\");\n    const isFromLogin = referer?.includes(\"/login\");\n    const userAgent = request.headers.get(\"user-agent\") || \"\";\n    if (!token) {\n        // Redirect to login for protected routes\n        if (pathname.startsWith(\"/api/\")) {\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                message: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n            addSecurityHeaders(response);\n            return response;\n        } else if (pathname.startsWith(\"/student\") || pathname.startsWith(\"/admin\")) {\n            // Special case: If coming from login page OR login API, allow through\n            // This prevents redirect loop after successful login\n            // The cookie might be setting, so give it a chance\n            if (isFromLogin || referer?.includes(\"/api/auth/login\")) {\n                console.log(\"⚠ No token but coming from login - allowing through (cookie might be setting)\");\n                console.log(\"⚠ Referer:\", referer);\n                console.log(\"⚠ Pathname:\", pathname);\n                const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].next();\n                addSecurityHeaders(response);\n                return response;\n            }\n            // For protected pages, redirect to login if no token\n            console.log(\"⚠ No token found for protected route:\", pathname);\n            console.log(\"⚠ Referer:\", referer);\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].redirect(new URL(\"/login\", request.url));\n            addSecurityHeaders(response);\n            return response;\n        }\n        // For other routes, allow through\n        const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].next();\n        addSecurityHeaders(response);\n        return response;\n    }\n    // Validate token\n    let user;\n    try {\n        user = (0,_lib_auth__WEBPACK_IMPORTED_MODULE_1__.verifyToken)(token);\n    } catch (error) {\n        console.error(\"Token verification error in middleware:\", error);\n        user = null;\n    }\n    if (!user) {\n        if (pathname.startsWith(\"/api/\")) {\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                message: \"Invalid or expired token\"\n            }, {\n                status: 401\n            });\n            addSecurityHeaders(response);\n            return response;\n        } else {\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].redirect(new URL(\"/login\", request.url));\n            response.cookies.delete(\"token\");\n            addSecurityHeaders(response);\n            return response;\n        }\n    }\n    // Check admin routes\n    if (pathname.startsWith(\"/admin\") && user.role !== \"admin\") {\n        if (pathname.startsWith(\"/api/\")) {\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Admin access required\"\n            }, {\n                status: 403\n            });\n            addSecurityHeaders(response);\n            return response;\n        } else {\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].redirect(new URL(\"/student/dashboard\", request.url));\n            addSecurityHeaders(response);\n            return response;\n        }\n    }\n    // Check student routes\n    if (pathname.startsWith(\"/student\") && user.role !== \"student\" && user.role !== \"admin\") {\n        if (pathname.startsWith(\"/api/\")) {\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Student access required\"\n            }, {\n                status: 403\n            });\n            addSecurityHeaders(response);\n            return response;\n        } else {\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].redirect(new URL(\"/login\", request.url));\n            addSecurityHeaders(response);\n            return response;\n        }\n    }\n    const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].next();\n    addSecurityHeaders(response);\n    return response;\n}\n// Add security headers\nfunction addSecurityHeaders(response) {\n    // Security headers\n    response.headers.set(\"X-Content-Type-Options\", \"nosniff\");\n    response.headers.set(\"X-Frame-Options\", \"DENY\");\n    response.headers.set(\"X-XSS-Protection\", \"1; mode=block\");\n    response.headers.set(\"Referrer-Policy\", \"strict-origin-when-cross-origin\");\n    response.headers.set(\"Permissions-Policy\", \"camera=(), microphone=(), geolocation=()\");\n    // Content Security Policy\n    const csp = [\n        \"default-src 'self'\",\n        \"script-src 'self' 'unsafe-eval' 'unsafe-inline' https://js.stripe.com\",\n        \"style-src 'self' 'unsafe-inline'\",\n        \"img-src 'self' data: https: blob:\",\n        \"font-src 'self' data:\",\n        \"connect-src 'self' https://api.stripe.com https://*.neon.tech\",\n        \"frame-src https://js.stripe.com https://hooks.stripe.com\",\n        \"object-src 'none'\",\n        \"base-uri 'self'\",\n        \"form-action 'self'\",\n        \"frame-ancestors 'none'\",\n        \"upgrade-insecure-requests\"\n    ].join(\"; \");\n    response.headers.set(\"Content-Security-Policy\", csp);\n    // Strict Transport Security (only in production)\n    if (false) {}\n}\nconst config = {\n    matcher: [\n        /*\r\n     * Match all request paths except for the ones starting with:\r\n     * - _next/static (static files)\r\n     * - _next/image (image optimization files)\r\n     * - favicon.ico (favicon file)\r\n     * - public folder\r\n     */ \"/((?!_next/static|_next/image|favicon.ico|public/).*)\"\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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dkIsU0FBU0UsbUJBQW1CRixRQUFzQjtJQUNoRCxtQkFBbUI7SUFDbkJBLFNBQVNRLE9BQU8sQ0FBQ2dCLEdBQUcsQ0FBQywwQkFBMEI7SUFDL0N4QixTQUFTUSxPQUFPLENBQUNnQixHQUFHLENBQUMsbUJBQW1CO0lBQ3hDeEIsU0FBU1EsT0FBTyxDQUFDZ0IsR0FBRyxDQUFDLG9CQUFvQjtJQUN6Q3hCLFNBQVNRLE9BQU8sQ0FBQ2dCLEdBQUcsQ0FBQyxtQkFBbUI7SUFDeEN4QixTQUFTUSxPQUFPLENBQUNnQixHQUFHLENBQUMsc0JBQXNCO0lBRTNDLDBCQUEwQjtJQUMxQixNQUFNQyxNQUFNO1FBQ1Y7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO0tBQ0QsQ0FBQ0MsSUFBSSxDQUFDO0lBRVAxQixTQUFTUSxPQUFPLENBQUNnQixHQUFHLENBQUMsMkJBQTJCQztJQUVoRCxpREFBaUQ7SUFDakQsSUFBSUUsS0FBeUIsRUFBYyxFQUUxQztBQUNIO0FBRU8sTUFBTUMsU0FBUztJQUNwQkMsU0FBUztRQUNQOzs7Ozs7S0FNQyxHQUNEO0tBQ0Q7QUFDSCxFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vX05fRS8uL3NyYy9taWRkbGV3YXJlLnRzP2QxOTkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xyXG5pbXBvcnQgdHlwZSB7IE5leHRSZXF1ZXN0IH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xyXG5pbXBvcnQgeyB2ZXJpZnlUb2tlbiB9IGZyb20gJy4vbGliL2F1dGgnO1xyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIG1pZGRsZXdhcmUocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcclxuICBjb25zdCB7IHBhdGhuYW1lIH0gPSByZXF1ZXN0Lm5leHRVcmw7XHJcblxyXG4gIC8vIFB1YmxpYyByb3V0ZXMgdGhhdCBkb24ndCByZXF1aXJlIGF1dGhlbnRpY2F0aW9uXHJcbiAgY29uc3QgcHVibGljUm91dGVzID0gWycvbG9naW4nLCAnL3JlZ2lzdGVyJywgJy9mb3Jnb3QtcGFzc3dvcmQnLCAnL3Jlc2V0LXBhc3N3b3JkJywgJy8nLCAnL2FkbWluJywgJy9zdHVkZW50J107XHJcbiAgY29uc3QgaXNQdWJsaWNSb3V0ZSA9IHB1YmxpY1JvdXRlcy5zb21lKHJvdXRlID0+IHBhdGhuYW1lID09PSByb3V0ZSB8fCBwYXRobmFtZS5zdGFydHNXaXRoKHJvdXRlICsgJy8nKSk7XHJcblxyXG4gIC8vIEFQSSByb3V0ZXMgdGhhdCBkb24ndCByZXF1aXJlIGF1dGhlbnRpY2F0aW9uXHJcbiAgY29uc3QgcHVibGljQXBpUm91dGVzID0gW1xyXG4gICAgJy9hcGkvYXV0aC9sb2dpbicsXHJcbiAgICAnL2FwaS9hdXRoL3JlZ2lzdGVyJyxcclxuICAgICcvYXBpL2F1dGgvZm9yZ290LXBhc3N3b3JkJyxcclxuICAgICcvYXBpL2F1dGgvcmVzZXQtcGFzc3dvcmQnLFxyXG4gICAgJy9hcGkvdGVzdC1kYicsXHJcbiAgICAnL2FwaS9wYXltZW50cy93ZWJob29rJywgLy8gU3RyaXBlIHdlYmhvb2tcclxuICAgICcvYXBpL2F1dGgvbWUnLCAvLyBBbGxvdyAvYXBpL2F1dGgvbWUgdG8gYmUgY2FsbGVkIC0gaXQgd2lsbCBjaGVjayB0b2tlbiBpbnRlcm5hbGx5XHJcbiAgXTtcclxuICBjb25zdCBpc1B1YmxpY0FwaVJvdXRlID0gcHVibGljQXBpUm91dGVzLnNvbWUocm91dGUgPT4gcGF0aG5hbWUuc3RhcnRzV2l0aChyb3V0ZSkpO1xyXG5cclxuICAvLyBJZiBpdCdzIGEgcHVibGljIHJvdXRlIG9yIEFQSSByb3V0ZSwgYWxsb3cgYWNjZXNzXHJcbiAgaWYgKGlzUHVibGljUm91dGUgfHwgaXNQdWJsaWNBcGlSb3V0ZSkge1xyXG4gICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UubmV4dCgpO1xyXG4gICAgYWRkU2VjdXJpdHlIZWFkZXJzKHJlc3BvbnNlKTtcclxuICAgIHJldHVybiByZXNwb25zZTtcclxuICB9XHJcblxyXG4gIC8vIENoZWNrIGZvciBhdXRoZW50aWNhdGlvbiB0b2tlbiBjb29raWVcclxuICBjb25zdCB0b2tlbiA9IHJlcXVlc3QuY29va2llcy5nZXQoJ3Rva2VuJyk/LnZhbHVlO1xyXG4gIFxyXG4gIC8vIENoZWNrIGlmIHRoaXMgaXMgYSByZWRpcmVjdCBmcm9tIGxvZ2luIChjaGVjayByZWZlcmVyIGhlYWRlcilcclxuICBjb25zdCByZWZlcmVyID0gcmVxdWVzdC5oZWFkZXJzLmdldCgncmVmZXJlcicpO1xyXG4gIGNvbnN0IGlzRnJvbUxvZ2luID0gcmVmZXJlcj8uaW5jbHVkZXMoJy9sb2dpbicpO1xyXG4gIGNvbnN0IHVzZXJBZ2VudCA9IHJlcXVlc3QuaGVhZGVycy5nZXQoJ3VzZXItYWdlbnQnKSB8fCAnJztcclxuXHJcbiAgaWYgKCF0b2tlbikge1xyXG4gICAgLy8gUmVkaXJlY3QgdG8gbG9naW4gZm9yIHByb3RlY3RlZCByb3V0ZXNcclxuICAgIGlmIChwYXRobmFtZS5zdGFydHNXaXRoKCcvYXBpLycpKSB7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLmpzb24oeyBtZXNzYWdlOiAnVW5hdXRob3JpemVkJyB9LCB7IHN0YXR1czogNDAxIH0pO1xyXG4gICAgICBhZGRTZWN1cml0eUhlYWRlcnMocmVzcG9uc2UpO1xyXG4gICAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgICB9IGVsc2UgaWYgKHBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9zdHVkZW50JykgfHwgcGF0aG5hbWUuc3RhcnRzV2l0aCgnL2FkbWluJykpIHtcclxuICAgICAgLy8gU3BlY2lhbCBjYXNlOiBJZiBjb21pbmcgZnJvbSBsb2dpbiBwYWdlIE9SIGxvZ2luIEFQSSwgYWxsb3cgdGhyb3VnaFxyXG4gICAgICAvLyBUaGlzIHByZXZlbnRzIHJlZGlyZWN0IGxvb3AgYWZ0ZXIgc3VjY2Vzc2Z1bCBsb2dpblxyXG4gICAgICAvLyBUaGUgY29va2llIG1pZ2h0IGJlIHNldHRpbmcsIHNvIGdpdmUgaXQgYSBjaGFuY2VcclxuICAgICAgaWYgKGlzRnJvbUxvZ2luIHx8IHJlZmVyZXI/LmluY2x1ZGVzKCcvYXBpL2F1dGgvbG9naW4nKSkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCfimqAgTm8gdG9rZW4gYnV0IGNvbWluZyBmcm9tIGxvZ2luIC0gYWxsb3dpbmcgdGhyb3VnaCAoY29va2llIG1pZ2h0IGJlIHNldHRpbmcpJyk7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ+KaoCBSZWZlcmVyOicsIHJlZmVyZXIpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCfimqAgUGF0aG5hbWU6JywgcGF0aG5hbWUpO1xyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLm5leHQoKTtcclxuICAgICAgICBhZGRTZWN1cml0eUhlYWRlcnMocmVzcG9uc2UpO1xyXG4gICAgICAgIHJldHVybiByZXNwb25zZTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gRm9yIHByb3RlY3RlZCBwYWdlcywgcmVkaXJlY3QgdG8gbG9naW4gaWYgbm8gdG9rZW5cclxuICAgICAgY29uc29sZS5sb2coJ+KaoCBObyB0b2tlbiBmb3VuZCBmb3IgcHJvdGVjdGVkIHJvdXRlOicsIHBhdGhuYW1lKTtcclxuICAgICAgY29uc29sZS5sb2coJ+KaoCBSZWZlcmVyOicsIHJlZmVyZXIpO1xyXG4gICAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5yZWRpcmVjdChuZXcgVVJMKCcvbG9naW4nLCByZXF1ZXN0LnVybCkpO1xyXG4gICAgICBhZGRTZWN1cml0eUhlYWRlcnMocmVzcG9uc2UpO1xyXG4gICAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIEZvciBvdGhlciByb3V0ZXMsIGFsbG93IHRocm91Z2hcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLm5leHQoKTtcclxuICAgIGFkZFNlY3VyaXR5SGVhZGVycyhyZXNwb25zZSk7XHJcbiAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgfVxyXG5cclxuICAvLyBWYWxpZGF0ZSB0b2tlblxyXG4gIGxldCB1c2VyO1xyXG4gIHRyeSB7XHJcbiAgICB1c2VyID0gdmVyaWZ5VG9rZW4odG9rZW4pO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdUb2tlbiB2ZXJpZmljYXRpb24gZXJyb3IgaW4gbWlkZGxld2FyZTonLCBlcnJvcik7XHJcbiAgICB1c2VyID0gbnVsbDtcclxuICB9XHJcbiAgXHJcbiAgaWYgKCF1c2VyKSB7XHJcbiAgICBpZiAocGF0aG5hbWUuc3RhcnRzV2l0aCgnL2FwaS8nKSkge1xyXG4gICAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5qc29uKHsgbWVzc2FnZTogJ0ludmFsaWQgb3IgZXhwaXJlZCB0b2tlbicgfSwgeyBzdGF0dXM6IDQwMSB9KTtcclxuICAgICAgYWRkU2VjdXJpdHlIZWFkZXJzKHJlc3BvbnNlKTtcclxuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTCgnL2xvZ2luJywgcmVxdWVzdC51cmwpKTtcclxuICAgICAgcmVzcG9uc2UuY29va2llcy5kZWxldGUoJ3Rva2VuJyk7XHJcbiAgICAgIGFkZFNlY3VyaXR5SGVhZGVycyhyZXNwb25zZSk7XHJcbiAgICAgIHJldHVybiByZXNwb25zZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIENoZWNrIGFkbWluIHJvdXRlc1xyXG4gIGlmIChwYXRobmFtZS5zdGFydHNXaXRoKCcvYWRtaW4nKSAmJiB1c2VyLnJvbGUgIT09ICdhZG1pbicpIHtcclxuICAgIGlmIChwYXRobmFtZS5zdGFydHNXaXRoKCcvYXBpLycpKSB7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ0FkbWluIGFjY2VzcyByZXF1aXJlZCcgfSwgeyBzdGF0dXM6IDQwMyB9KTtcclxuICAgICAgYWRkU2VjdXJpdHlIZWFkZXJzKHJlc3BvbnNlKTtcclxuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTCgnL3N0dWRlbnQvZGFzaGJvYXJkJywgcmVxdWVzdC51cmwpKTtcclxuICAgICAgYWRkU2VjdXJpdHlIZWFkZXJzKHJlc3BvbnNlKTtcclxuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gQ2hlY2sgc3R1ZGVudCByb3V0ZXNcclxuICBpZiAocGF0aG5hbWUuc3RhcnRzV2l0aCgnL3N0dWRlbnQnKSAmJiB1c2VyLnJvbGUgIT09ICdzdHVkZW50JyAmJiB1c2VyLnJvbGUgIT09ICdhZG1pbicpIHtcclxuICAgIGlmIChwYXRobmFtZS5zdGFydHNXaXRoKCcvYXBpLycpKSB7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ1N0dWRlbnQgYWNjZXNzIHJlcXVpcmVkJyB9LCB7IHN0YXR1czogNDAzIH0pO1xyXG4gICAgICBhZGRTZWN1cml0eUhlYWRlcnMocmVzcG9uc2UpO1xyXG4gICAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5yZWRpcmVjdChuZXcgVVJMKCcvbG9naW4nLCByZXF1ZXN0LnVybCkpO1xyXG4gICAgICBhZGRTZWN1cml0eUhlYWRlcnMocmVzcG9uc2UpO1xyXG4gICAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5uZXh0KCk7XHJcbiAgYWRkU2VjdXJpdHlIZWFkZXJzKHJlc3BvbnNlKTtcclxuICByZXR1cm4gcmVzcG9uc2U7XHJcbn1cclxuXHJcbi8vIEFkZCBzZWN1cml0eSBoZWFkZXJzXHJcbmZ1bmN0aW9uIGFkZFNlY3VyaXR5SGVhZGVycyhyZXNwb25zZTogTmV4dFJlc3BvbnNlKSB7XHJcbiAgLy8gU2VjdXJpdHkgaGVhZGVyc1xyXG4gIHJlc3BvbnNlLmhlYWRlcnMuc2V0KCdYLUNvbnRlbnQtVHlwZS1PcHRpb25zJywgJ25vc25pZmYnKTtcclxuICByZXNwb25zZS5oZWFkZXJzLnNldCgnWC1GcmFtZS1PcHRpb25zJywgJ0RFTlknKTtcclxuICByZXNwb25zZS5oZWFkZXJzLnNldCgnWC1YU1MtUHJvdGVjdGlvbicsICcxOyBtb2RlPWJsb2NrJyk7XHJcbiAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ1JlZmVycmVyLVBvbGljeScsICdzdHJpY3Qtb3JpZ2luLXdoZW4tY3Jvc3Mtb3JpZ2luJyk7XHJcbiAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ1Blcm1pc3Npb25zLVBvbGljeScsICdjYW1lcmE9KCksIG1pY3JvcGhvbmU9KCksIGdlb2xvY2F0aW9uPSgpJyk7XHJcbiAgXHJcbiAgLy8gQ29udGVudCBTZWN1cml0eSBQb2xpY3lcclxuICBjb25zdCBjc3AgPSBbXHJcbiAgICBcImRlZmF1bHQtc3JjICdzZWxmJ1wiLFxyXG4gICAgXCJzY3JpcHQtc3JjICdzZWxmJyAndW5zYWZlLWV2YWwnICd1bnNhZmUtaW5saW5lJyBodHRwczovL2pzLnN0cmlwZS5jb21cIixcclxuICAgIFwic3R5bGUtc3JjICdzZWxmJyAndW5zYWZlLWlubGluZSdcIixcclxuICAgIFwiaW1nLXNyYyAnc2VsZicgZGF0YTogaHR0cHM6IGJsb2I6XCIsXHJcbiAgICBcImZvbnQtc3JjICdzZWxmJyBkYXRhOlwiLFxyXG4gICAgXCJjb25uZWN0LXNyYyAnc2VsZicgaHR0cHM6Ly9hcGkuc3RyaXBlLmNvbSBodHRwczovLyoubmVvbi50ZWNoXCIsXHJcbiAgICBcImZyYW1lLXNyYyBodHRwczovL2pzLnN0cmlwZS5jb20gaHR0cHM6Ly9ob29rcy5zdHJpcGUuY29tXCIsXHJcbiAgICBcIm9iamVjdC1zcmMgJ25vbmUnXCIsXHJcbiAgICBcImJhc2UtdXJpICdzZWxmJ1wiLFxyXG4gICAgXCJmb3JtLWFjdGlvbiAnc2VsZidcIixcclxuICAgIFwiZnJhbWUtYW5jZXN0b3JzICdub25lJ1wiLFxyXG4gICAgXCJ1cGdyYWRlLWluc2VjdXJlLXJlcXVlc3RzXCIsXHJcbiAgXS5qb2luKCc7ICcpO1xyXG4gIFxyXG4gIHJlc3BvbnNlLmhlYWRlcnMuc2V0KCdDb250ZW50LVNlY3VyaXR5LVBvbGljeScsIGNzcCk7XHJcbiAgXHJcbiAgLy8gU3RyaWN0IFRyYW5zcG9ydCBTZWN1cml0eSAob25seSBpbiBwcm9kdWN0aW9uKVxyXG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nKSB7XHJcbiAgICByZXNwb25zZS5oZWFkZXJzLnNldCgnU3RyaWN0LVRyYW5zcG9ydC1TZWN1cml0eScsICdtYXgtYWdlPTMxNTM2MDAwOyBpbmNsdWRlU3ViRG9tYWluczsgcHJlbG9hZCcpO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcclxuICBtYXRjaGVyOiBbXHJcbiAgICAvKlxyXG4gICAgICogTWF0Y2ggYWxsIHJlcXVlc3QgcGF0aHMgZXhjZXB0IGZvciB0aGUgb25lcyBzdGFydGluZyB3aXRoOlxyXG4gICAgICogLSBfbmV4dC9zdGF0aWMgKHN0YXRpYyBmaWxlcylcclxuICAgICAqIC0gX25leHQvaW1hZ2UgKGltYWdlIG9wdGltaXphdGlvbiBmaWxlcylcclxuICAgICAqIC0gZmF2aWNvbi5pY28gKGZhdmljb24gZmlsZSlcclxuICAgICAqIC0gcHVibGljIGZvbGRlclxyXG4gICAgICovXHJcbiAgICAnLygoPyFfbmV4dC9zdGF0aWN8X25leHQvaW1hZ2V8ZmF2aWNvbi5pY298cHVibGljLykuKiknLFxyXG4gIF0sXHJcbn07XHJcbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJ2ZXJpZnlUb2tlbiIsIm1pZGRsZXdhcmUiLCJyZXF1ZXN0IiwicGF0aG5hbWUiLCJuZXh0VXJsIiwicHVibGljUm91dGVzIiwiaXNQdWJsaWNSb3V0ZSIsInNvbWUiLCJyb3V0ZSIsInN0YXJ0c1dpdGgiLCJwdWJsaWNBcGlSb3V0ZXMiLCJpc1B1YmxpY0FwaVJvdXRlIiwicmVzcG9uc2UiLCJuZXh0IiwiYWRkU2VjdXJpdHlIZWFkZXJzIiwidG9rZW4iLCJjb29raWVzIiwiZ2V0IiwidmFsdWUiLCJyZWZlcmVyIiwiaGVhZGVycyIsImlzRnJvbUxvZ2luIiwiaW5jbHVkZXMiLCJ1c2VyQWdlbnQiLCJqc29uIiwibWVzc2FnZSIsInN0YXR1cyIsImNvbnNvbGUiLCJsb2ciLCJyZWRpcmVjdCIsIlVSTCIsInVybCIsInVzZXIiLCJlcnJvciIsImRlbGV0ZSIsInJvbGUiLCJzZXQiLCJjc3AiLCJqb2luIiwicHJvY2VzcyIsImNvbmZpZyIsIm1hdGNoZXIiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(middleware)/./src/middleware.ts\n");

/***/ })

});