"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("src/middleware",{

/***/ "(middleware)/./src/middleware.ts":
/*!***************************!*\
  !*** ./src/middleware.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(middleware)/./node_modules/next/dist/esm/server/web/exports/next-response.js\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./lib/auth */ \"(middleware)/./src/lib/auth.ts\");\n\n\nasync function middleware(request) {\n    const { pathname } = request.nextUrl;\n    // Public routes that don't require authentication\n    const publicRoutes = [\n        \"/login\",\n        \"/register\",\n        \"/forgot-password\",\n        \"/reset-password\",\n        \"/\"\n    ];\n    const isPublicRoute = publicRoutes.some((route)=>pathname === route || pathname.startsWith(route + \"/\"));\n    // API routes that don't require authentication\n    const publicApiRoutes = [\n        \"/api/auth/login\",\n        \"/api/auth/register\",\n        \"/api/auth/forgot-password\",\n        \"/api/auth/reset-password\",\n        \"/api/test-db\",\n        \"/api/payments/webhook\"\n    ];\n    const isPublicApiRoute = publicApiRoutes.some((route)=>pathname.startsWith(route));\n    // If it's a public route or API route, allow access\n    if (isPublicRoute || isPublicApiRoute) {\n        const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].next();\n        addSecurityHeaders(response);\n        return response;\n    }\n    // Check for authentication token cookie\n    const token = request.cookies.get(\"token\")?.value;\n    // Check if this is a redirect from login (check referer header)\n    const referer = request.headers.get(\"referer\");\n    const isFromLogin = referer?.includes(\"/login\");\n    const userAgent = request.headers.get(\"user-agent\") || \"\";\n    if (!token) {\n        // Redirect to login for protected routes\n        if (pathname.startsWith(\"/api/\")) {\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                message: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n            addSecurityHeaders(response);\n            return response;\n        } else if (pathname.startsWith(\"/student\") || pathname.startsWith(\"/admin\")) {\n            // Special case: If coming from login page, allow through (cookie might be setting)\n            // This prevents redirect loop after successful login\n            if (isFromLogin) {\n                console.log(\"âš  No token but coming from login - allowing through (cookie might be setting)\");\n                const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].next();\n                addSecurityHeaders(response);\n                return response;\n            }\n            // For protected pages, redirect to login if no token\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].redirect(new URL(\"/login\", request.url));\n            addSecurityHeaders(response);\n            return response;\n        }\n        // For other routes, allow through\n        const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].next();\n        addSecurityHeaders(response);\n        return response;\n    }\n    // Validate token\n    let user;\n    try {\n        user = (0,_lib_auth__WEBPACK_IMPORTED_MODULE_1__.verifyToken)(token);\n    } catch (error) {\n        console.error(\"Token verification error in middleware:\", error);\n        user = null;\n    }\n    if (!user) {\n        if (pathname.startsWith(\"/api/\")) {\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                message: \"Invalid or expired token\"\n            }, {\n                status: 401\n            });\n            addSecurityHeaders(response);\n            return response;\n        } else {\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].redirect(new URL(\"/login\", request.url));\n            response.cookies.delete(\"token\");\n            addSecurityHeaders(response);\n            return response;\n        }\n    }\n    // Check admin routes\n    if (pathname.startsWith(\"/admin\") && user.role !== \"admin\") {\n        if (pathname.startsWith(\"/api/\")) {\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Admin access required\"\n            }, {\n                status: 403\n            });\n            addSecurityHeaders(response);\n            return response;\n        } else {\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].redirect(new URL(\"/student/dashboard\", request.url));\n            addSecurityHeaders(response);\n            return response;\n        }\n    }\n    // Check student routes\n    if (pathname.startsWith(\"/student\") && user.role !== \"student\" && user.role !== \"admin\") {\n        if (pathname.startsWith(\"/api/\")) {\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Student access required\"\n            }, {\n                status: 403\n            });\n            addSecurityHeaders(response);\n            return response;\n        } else {\n            const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].redirect(new URL(\"/login\", request.url));\n            addSecurityHeaders(response);\n            return response;\n        }\n    }\n    const response = next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].next();\n    addSecurityHeaders(response);\n    return response;\n}\n// Add security headers\nfunction addSecurityHeaders(response) {\n    // Security headers\n    response.headers.set(\"X-Content-Type-Options\", \"nosniff\");\n    response.headers.set(\"X-Frame-Options\", \"DENY\");\n    response.headers.set(\"X-XSS-Protection\", \"1; mode=block\");\n    response.headers.set(\"Referrer-Policy\", \"strict-origin-when-cross-origin\");\n    response.headers.set(\"Permissions-Policy\", \"camera=(), microphone=(), geolocation=()\");\n    // Content Security Policy\n    const csp = [\n        \"default-src 'self'\",\n        \"script-src 'self' 'unsafe-eval' 'unsafe-inline' https://js.stripe.com\",\n        \"style-src 'self' 'unsafe-inline'\",\n        \"img-src 'self' data: https: blob:\",\n        \"font-src 'self' data:\",\n        \"connect-src 'self' https://api.stripe.com https://*.neon.tech\",\n        \"frame-src https://js.stripe.com https://hooks.stripe.com\",\n        \"object-src 'none'\",\n        \"base-uri 'self'\",\n        \"form-action 'self'\",\n        \"frame-ancestors 'none'\",\n        \"upgrade-insecure-requests\"\n    ].join(\"; \");\n    response.headers.set(\"Content-Security-Policy\", csp);\n    // Strict Transport Security (only in production)\n    if (false) {}\n}\nconst config = {\n    matcher: [\n        /*\r\n     * Match all request paths except for the ones starting with:\r\n     * - _next/static (static files)\r\n     * - _next/image (image optimization files)\r\n     * - favicon.ico (favicon file)\r\n     * - public folder\r\n     */ \"/((?!_next/static|_next/image|favicon.ico|public/).*)\"\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QixTQUFTUSxPQUFPLENBQUNnQixHQUFHLENBQUMsbUJBQW1CO0lBQ3hDeEIsU0FBU1EsT0FBTyxDQUFDZ0IsR0FBRyxDQUFDLHNCQUFzQjtJQUUzQywwQkFBMEI7SUFDMUIsTUFBTUMsTUFBTTtRQUNWO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtLQUNELENBQUNDLElBQUksQ0FBQztJQUVQMUIsU0FBU1EsT0FBTyxDQUFDZ0IsR0FBRyxDQUFDLDJCQUEyQkM7SUFFaEQsaURBQWlEO0lBQ2pELElBQUlFLEtBQXlCLEVBQWMsRUFFMUM7QUFDSDtBQUVPLE1BQU1DLFNBQVM7SUFDcEJDLFNBQVM7UUFDUDs7Ozs7O0tBTUMsR0FDRDtLQUNEO0FBQ0gsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovL19OX0UvLi9zcmMvbWlkZGxld2FyZS50cz9kMTk5Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcclxuaW1wb3J0IHR5cGUgeyBOZXh0UmVxdWVzdCB9IGZyb20gJ25leHQvc2VydmVyJztcclxuaW1wb3J0IHsgdmVyaWZ5VG9rZW4gfSBmcm9tICcuL2xpYi9hdXRoJztcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBtaWRkbGV3YXJlKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XHJcbiAgY29uc3QgeyBwYXRobmFtZSB9ID0gcmVxdWVzdC5uZXh0VXJsO1xyXG5cclxuICAvLyBQdWJsaWMgcm91dGVzIHRoYXQgZG9uJ3QgcmVxdWlyZSBhdXRoZW50aWNhdGlvblxyXG4gIGNvbnN0IHB1YmxpY1JvdXRlcyA9IFsnL2xvZ2luJywgJy9yZWdpc3RlcicsICcvZm9yZ290LXBhc3N3b3JkJywgJy9yZXNldC1wYXNzd29yZCcsICcvJ107XHJcbiAgY29uc3QgaXNQdWJsaWNSb3V0ZSA9IHB1YmxpY1JvdXRlcy5zb21lKHJvdXRlID0+IHBhdGhuYW1lID09PSByb3V0ZSB8fCBwYXRobmFtZS5zdGFydHNXaXRoKHJvdXRlICsgJy8nKSk7XHJcblxyXG4gIC8vIEFQSSByb3V0ZXMgdGhhdCBkb24ndCByZXF1aXJlIGF1dGhlbnRpY2F0aW9uXHJcbiAgY29uc3QgcHVibGljQXBpUm91dGVzID0gW1xyXG4gICAgJy9hcGkvYXV0aC9sb2dpbicsXHJcbiAgICAnL2FwaS9hdXRoL3JlZ2lzdGVyJyxcclxuICAgICcvYXBpL2F1dGgvZm9yZ290LXBhc3N3b3JkJyxcclxuICAgICcvYXBpL2F1dGgvcmVzZXQtcGFzc3dvcmQnLFxyXG4gICAgJy9hcGkvdGVzdC1kYicsXHJcbiAgICAnL2FwaS9wYXltZW50cy93ZWJob29rJywgLy8gU3RyaXBlIHdlYmhvb2tcclxuICBdO1xyXG4gIGNvbnN0IGlzUHVibGljQXBpUm91dGUgPSBwdWJsaWNBcGlSb3V0ZXMuc29tZShyb3V0ZSA9PiBwYXRobmFtZS5zdGFydHNXaXRoKHJvdXRlKSk7XHJcblxyXG4gIC8vIElmIGl0J3MgYSBwdWJsaWMgcm91dGUgb3IgQVBJIHJvdXRlLCBhbGxvdyBhY2Nlc3NcclxuICBpZiAoaXNQdWJsaWNSb3V0ZSB8fCBpc1B1YmxpY0FwaVJvdXRlKSB7XHJcbiAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5uZXh0KCk7XHJcbiAgICBhZGRTZWN1cml0eUhlYWRlcnMocmVzcG9uc2UpO1xyXG4gICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gIH1cclxuXHJcbiAgLy8gQ2hlY2sgZm9yIGF1dGhlbnRpY2F0aW9uIHRva2VuIGNvb2tpZVxyXG4gIGNvbnN0IHRva2VuID0gcmVxdWVzdC5jb29raWVzLmdldCgndG9rZW4nKT8udmFsdWU7XHJcbiAgXHJcbiAgLy8gQ2hlY2sgaWYgdGhpcyBpcyBhIHJlZGlyZWN0IGZyb20gbG9naW4gKGNoZWNrIHJlZmVyZXIgaGVhZGVyKVxyXG4gIGNvbnN0IHJlZmVyZXIgPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KCdyZWZlcmVyJyk7XHJcbiAgY29uc3QgaXNGcm9tTG9naW4gPSByZWZlcmVyPy5pbmNsdWRlcygnL2xvZ2luJyk7XHJcbiAgY29uc3QgdXNlckFnZW50ID0gcmVxdWVzdC5oZWFkZXJzLmdldCgndXNlci1hZ2VudCcpIHx8ICcnO1xyXG5cclxuICBpZiAoIXRva2VuKSB7XHJcbiAgICAvLyBSZWRpcmVjdCB0byBsb2dpbiBmb3IgcHJvdGVjdGVkIHJvdXRlc1xyXG4gICAgaWYgKHBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9hcGkvJykpIHtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UuanNvbih7IG1lc3NhZ2U6ICdVbmF1dGhvcml6ZWQnIH0sIHsgc3RhdHVzOiA0MDEgfSk7XHJcbiAgICAgIGFkZFNlY3VyaXR5SGVhZGVycyhyZXNwb25zZSk7XHJcbiAgICAgIHJldHVybiByZXNwb25zZTtcclxuICAgIH0gZWxzZSBpZiAocGF0aG5hbWUuc3RhcnRzV2l0aCgnL3N0dWRlbnQnKSB8fCBwYXRobmFtZS5zdGFydHNXaXRoKCcvYWRtaW4nKSkge1xyXG4gICAgICAvLyBTcGVjaWFsIGNhc2U6IElmIGNvbWluZyBmcm9tIGxvZ2luIHBhZ2UsIGFsbG93IHRocm91Z2ggKGNvb2tpZSBtaWdodCBiZSBzZXR0aW5nKVxyXG4gICAgICAvLyBUaGlzIHByZXZlbnRzIHJlZGlyZWN0IGxvb3AgYWZ0ZXIgc3VjY2Vzc2Z1bCBsb2dpblxyXG4gICAgICBpZiAoaXNGcm9tTG9naW4pIHtcclxuICAgICAgICBjb25zb2xlLmxvZygn4pqgIE5vIHRva2VuIGJ1dCBjb21pbmcgZnJvbSBsb2dpbiAtIGFsbG93aW5nIHRocm91Z2ggKGNvb2tpZSBtaWdodCBiZSBzZXR0aW5nKScpO1xyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLm5leHQoKTtcclxuICAgICAgICBhZGRTZWN1cml0eUhlYWRlcnMocmVzcG9uc2UpO1xyXG4gICAgICAgIHJldHVybiByZXNwb25zZTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gRm9yIHByb3RlY3RlZCBwYWdlcywgcmVkaXJlY3QgdG8gbG9naW4gaWYgbm8gdG9rZW5cclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTCgnL2xvZ2luJywgcmVxdWVzdC51cmwpKTtcclxuICAgICAgYWRkU2VjdXJpdHlIZWFkZXJzKHJlc3BvbnNlKTtcclxuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBGb3Igb3RoZXIgcm91dGVzLCBhbGxvdyB0aHJvdWdoXHJcbiAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5uZXh0KCk7XHJcbiAgICBhZGRTZWN1cml0eUhlYWRlcnMocmVzcG9uc2UpO1xyXG4gICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gIH1cclxuXHJcbiAgLy8gVmFsaWRhdGUgdG9rZW5cclxuICBsZXQgdXNlcjtcclxuICB0cnkge1xyXG4gICAgdXNlciA9IHZlcmlmeVRva2VuKHRva2VuKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignVG9rZW4gdmVyaWZpY2F0aW9uIGVycm9yIGluIG1pZGRsZXdhcmU6JywgZXJyb3IpO1xyXG4gICAgdXNlciA9IG51bGw7XHJcbiAgfVxyXG4gIFxyXG4gIGlmICghdXNlcikge1xyXG4gICAgaWYgKHBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9hcGkvJykpIHtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UuanNvbih7IG1lc3NhZ2U6ICdJbnZhbGlkIG9yIGV4cGlyZWQgdG9rZW4nIH0sIHsgc3RhdHVzOiA0MDEgfSk7XHJcbiAgICAgIGFkZFNlY3VyaXR5SGVhZGVycyhyZXNwb25zZSk7XHJcbiAgICAgIHJldHVybiByZXNwb25zZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KG5ldyBVUkwoJy9sb2dpbicsIHJlcXVlc3QudXJsKSk7XHJcbiAgICAgIHJlc3BvbnNlLmNvb2tpZXMuZGVsZXRlKCd0b2tlbicpO1xyXG4gICAgICBhZGRTZWN1cml0eUhlYWRlcnMocmVzcG9uc2UpO1xyXG4gICAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBDaGVjayBhZG1pbiByb3V0ZXNcclxuICBpZiAocGF0aG5hbWUuc3RhcnRzV2l0aCgnL2FkbWluJykgJiYgdXNlci5yb2xlICE9PSAnYWRtaW4nKSB7XHJcbiAgICBpZiAocGF0aG5hbWUuc3RhcnRzV2l0aCgnL2FwaS8nKSkge1xyXG4gICAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdBZG1pbiBhY2Nlc3MgcmVxdWlyZWQnIH0sIHsgc3RhdHVzOiA0MDMgfSk7XHJcbiAgICAgIGFkZFNlY3VyaXR5SGVhZGVycyhyZXNwb25zZSk7XHJcbiAgICAgIHJldHVybiByZXNwb25zZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KG5ldyBVUkwoJy9zdHVkZW50L2Rhc2hib2FyZCcsIHJlcXVlc3QudXJsKSk7XHJcbiAgICAgIGFkZFNlY3VyaXR5SGVhZGVycyhyZXNwb25zZSk7XHJcbiAgICAgIHJldHVybiByZXNwb25zZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIENoZWNrIHN0dWRlbnQgcm91dGVzXHJcbiAgaWYgKHBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9zdHVkZW50JykgJiYgdXNlci5yb2xlICE9PSAnc3R1ZGVudCcgJiYgdXNlci5yb2xlICE9PSAnYWRtaW4nKSB7XHJcbiAgICBpZiAocGF0aG5hbWUuc3RhcnRzV2l0aCgnL2FwaS8nKSkge1xyXG4gICAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdTdHVkZW50IGFjY2VzcyByZXF1aXJlZCcgfSwgeyBzdGF0dXM6IDQwMyB9KTtcclxuICAgICAgYWRkU2VjdXJpdHlIZWFkZXJzKHJlc3BvbnNlKTtcclxuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTCgnL2xvZ2luJywgcmVxdWVzdC51cmwpKTtcclxuICAgICAgYWRkU2VjdXJpdHlIZWFkZXJzKHJlc3BvbnNlKTtcclxuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UubmV4dCgpO1xyXG4gIGFkZFNlY3VyaXR5SGVhZGVycyhyZXNwb25zZSk7XHJcbiAgcmV0dXJuIHJlc3BvbnNlO1xyXG59XHJcblxyXG4vLyBBZGQgc2VjdXJpdHkgaGVhZGVyc1xyXG5mdW5jdGlvbiBhZGRTZWN1cml0eUhlYWRlcnMocmVzcG9uc2U6IE5leHRSZXNwb25zZSkge1xyXG4gIC8vIFNlY3VyaXR5IGhlYWRlcnNcclxuICByZXNwb25zZS5oZWFkZXJzLnNldCgnWC1Db250ZW50LVR5cGUtT3B0aW9ucycsICdub3NuaWZmJyk7XHJcbiAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ1gtRnJhbWUtT3B0aW9ucycsICdERU5ZJyk7XHJcbiAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ1gtWFNTLVByb3RlY3Rpb24nLCAnMTsgbW9kZT1ibG9jaycpO1xyXG4gIHJlc3BvbnNlLmhlYWRlcnMuc2V0KCdSZWZlcnJlci1Qb2xpY3knLCAnc3RyaWN0LW9yaWdpbi13aGVuLWNyb3NzLW9yaWdpbicpO1xyXG4gIHJlc3BvbnNlLmhlYWRlcnMuc2V0KCdQZXJtaXNzaW9ucy1Qb2xpY3knLCAnY2FtZXJhPSgpLCBtaWNyb3Bob25lPSgpLCBnZW9sb2NhdGlvbj0oKScpO1xyXG4gIFxyXG4gIC8vIENvbnRlbnQgU2VjdXJpdHkgUG9saWN5XHJcbiAgY29uc3QgY3NwID0gW1xyXG4gICAgXCJkZWZhdWx0LXNyYyAnc2VsZidcIixcclxuICAgIFwic2NyaXB0LXNyYyAnc2VsZicgJ3Vuc2FmZS1ldmFsJyAndW5zYWZlLWlubGluZScgaHR0cHM6Ly9qcy5zdHJpcGUuY29tXCIsXHJcbiAgICBcInN0eWxlLXNyYyAnc2VsZicgJ3Vuc2FmZS1pbmxpbmUnXCIsXHJcbiAgICBcImltZy1zcmMgJ3NlbGYnIGRhdGE6IGh0dHBzOiBibG9iOlwiLFxyXG4gICAgXCJmb250LXNyYyAnc2VsZicgZGF0YTpcIixcclxuICAgIFwiY29ubmVjdC1zcmMgJ3NlbGYnIGh0dHBzOi8vYXBpLnN0cmlwZS5jb20gaHR0cHM6Ly8qLm5lb24udGVjaFwiLFxyXG4gICAgXCJmcmFtZS1zcmMgaHR0cHM6Ly9qcy5zdHJpcGUuY29tIGh0dHBzOi8vaG9va3Muc3RyaXBlLmNvbVwiLFxyXG4gICAgXCJvYmplY3Qtc3JjICdub25lJ1wiLFxyXG4gICAgXCJiYXNlLXVyaSAnc2VsZidcIixcclxuICAgIFwiZm9ybS1hY3Rpb24gJ3NlbGYnXCIsXHJcbiAgICBcImZyYW1lLWFuY2VzdG9ycyAnbm9uZSdcIixcclxuICAgIFwidXBncmFkZS1pbnNlY3VyZS1yZXF1ZXN0c1wiLFxyXG4gIF0uam9pbignOyAnKTtcclxuICBcclxuICByZXNwb25zZS5oZWFkZXJzLnNldCgnQ29udGVudC1TZWN1cml0eS1Qb2xpY3knLCBjc3ApO1xyXG4gIFxyXG4gIC8vIFN0cmljdCBUcmFuc3BvcnQgU2VjdXJpdHkgKG9ubHkgaW4gcHJvZHVjdGlvbilcclxuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJykge1xyXG4gICAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ1N0cmljdC1UcmFuc3BvcnQtU2VjdXJpdHknLCAnbWF4LWFnZT0zMTUzNjAwMDsgaW5jbHVkZVN1YkRvbWFpbnM7IHByZWxvYWQnKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBjb25maWcgPSB7XHJcbiAgbWF0Y2hlcjogW1xyXG4gICAgLypcclxuICAgICAqIE1hdGNoIGFsbCByZXF1ZXN0IHBhdGhzIGV4Y2VwdCBmb3IgdGhlIG9uZXMgc3RhcnRpbmcgd2l0aDpcclxuICAgICAqIC0gX25leHQvc3RhdGljIChzdGF0aWMgZmlsZXMpXHJcbiAgICAgKiAtIF9uZXh0L2ltYWdlIChpbWFnZSBvcHRpbWl6YXRpb24gZmlsZXMpXHJcbiAgICAgKiAtIGZhdmljb24uaWNvIChmYXZpY29uIGZpbGUpXHJcbiAgICAgKiAtIHB1YmxpYyBmb2xkZXJcclxuICAgICAqL1xyXG4gICAgJy8oKD8hX25leHQvc3RhdGljfF9uZXh0L2ltYWdlfGZhdmljb24uaWNvfHB1YmxpYy8pLiopJyxcclxuICBdLFxyXG59O1xyXG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwidmVyaWZ5VG9rZW4iLCJtaWRkbGV3YXJlIiwicmVxdWVzdCIsInBhdGhuYW1lIiwibmV4dFVybCIsInB1YmxpY1JvdXRlcyIsImlzUHVibGljUm91dGUiLCJzb21lIiwicm91dGUiLCJzdGFydHNXaXRoIiwicHVibGljQXBpUm91dGVzIiwiaXNQdWJsaWNBcGlSb3V0ZSIsInJlc3BvbnNlIiwibmV4dCIsImFkZFNlY3VyaXR5SGVhZGVycyIsInRva2VuIiwiY29va2llcyIsImdldCIsInZhbHVlIiwicmVmZXJlciIsImhlYWRlcnMiLCJpc0Zyb21Mb2dpbiIsImluY2x1ZGVzIiwidXNlckFnZW50IiwianNvbiIsIm1lc3NhZ2UiLCJzdGF0dXMiLCJjb25zb2xlIiwibG9nIiwicmVkaXJlY3QiLCJVUkwiLCJ1cmwiLCJ1c2VyIiwiZXJyb3IiLCJkZWxldGUiLCJyb2xlIiwic2V0IiwiY3NwIiwiam9pbiIsInByb2Nlc3MiLCJjb25maWciLCJtYXRjaGVyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(middleware)/./src/middleware.ts\n");

/***/ })

});